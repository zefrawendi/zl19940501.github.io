<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto Slab:300,300italic,400,400italic,700,700italic|Console:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="CentOS8安装Openstack V版,虚拟机安装，1个控制节点，1个计算节点">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack Ussuri版安装过程记录">
<meta property="og:url" content="http://example.com/2021/06/02/OpenStack%20Victoria%E7%89%88%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="Lei&#39;s Blog">
<meta property="og:description" content="CentOS8安装Openstack V版,虚拟机安装，1个控制节点，1个计算节点">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/zl19940501/image_repository/blog_img01/%E5%8F%AF%E5%8F%AF%E7%88%B1%E6%B2%B9%E7%88%86%E5%8F%BD%E4%B8%81%E5%8D%A1%E9%80%9A%E5%9B%BE%E7%89%87%E5%A3%81%E7%BA%B8%20-%209.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/zl19940501/image_repository/blog_img01/image-20210531110906702.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/zl19940501/image_repository/blog_img01/image-20210531111252051.png">
<meta property="article:published_time" content="2021-06-02T07:08:07.000Z">
<meta property="article:modified_time" content="2021-06-02T07:28:21.089Z">
<meta property="article:author" content="Lei">
<meta property="article:tag" content="Openstack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/zl19940501/image_repository/blog_img01/%E5%8F%AF%E5%8F%AF%E7%88%B1%E6%B2%B9%E7%88%86%E5%8F%BD%E4%B8%81%E5%8D%A1%E9%80%9A%E5%9B%BE%E7%89%87%E5%A3%81%E7%BA%B8%20-%209.jpg">

<link rel="canonical" href="http://example.com/2021/06/02/OpenStack%20Victoria%E7%89%88%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>OpenStack Ussuri版安装过程记录 | Lei's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lei's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">^_^</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">1</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">2</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">3</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/02/OpenStack%20Victoria%E7%89%88%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Lei">
      <meta itemprop="description" content="备忘~">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lei's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OpenStack Ussuri版安装过程记录
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-02 15:08:07 / 修改时间：15:28:21" itemprop="dateCreated datePublished" datetime="2021-06-02T15:08:07+08:00">2021-06-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">运维笔记</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>52k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>47 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://cdn.jsdelivr.net/gh/zl19940501/image_repository/blog_img01/%E5%8F%AF%E5%8F%AF%E7%88%B1%E6%B2%B9%E7%88%86%E5%8F%BD%E4%B8%81%E5%8D%A1%E9%80%9A%E5%9B%BE%E7%89%87%E5%A3%81%E7%BA%B8%20-%209.jpg"><br>CentOS8安装Openstack V版,虚拟机安装，1个控制节点，1个计算节点</p>
<span id="more"></span>
<h1 id="一、安装前准备"><a href="#一、安装前准备" class="headerlink" title="一、安装前准备"></a>一、安装前准备</h1><p>VMwareWorkstation &amp;&amp; CentOS8系统</p>
<h2 id="1、VMware-Workstation虚拟网络设置"><a href="#1、VMware-Workstation虚拟网络设置" class="headerlink" title="1、VMware Workstation虚拟网络设置"></a>1、VMware Workstation虚拟网络设置</h2><p>编辑》虚拟网络编辑器》更改设置</p>
<p>VMnet0桥接模式</p>
<p>VMnet8 NAT模式(10.0.0.2/24) 注意此处的网关为10.0.0.2，在后面进行虚拟机IP地址配置时候需要将网关配置为不是10.0.0.2。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zl19940501/image_repository/blog_img01/image-20210531110906702.png" alt="image-20210531110906702"></p>
<h2 id="2、虚拟机硬件设置"><a href="#2、虚拟机硬件设置" class="headerlink" title="2、虚拟机硬件设置"></a>2、虚拟机硬件设置</h2><p><img src="https://cdn.jsdelivr.net/gh/zl19940501/image_repository/blog_img01/image-20210531111252051.png" alt="image-20210531111252051"></p>
<p>这里需要注意的有以下几点（后面会贴出OpenStack官方的建议硬件配置)：</p>
<p>1.内存：建议不小于4G</p>
<p>2.处理器：建议内核总数不小于2核</p>
<p>3.网络适配器：第1张网卡ens33采用的是NAT网络，为10.0.0.2/24；第2张网卡采用的是桥接网络，当前为192.168.1.0/24。</p>
<h2 id="3、主机规划"><a href="#3、主机规划" class="headerlink" title="3、主机规划"></a>3、主机规划</h2><table>
<thead>
<tr>
<th align="center">主机名</th>
<th>管理网络</th>
<th>网卡1</th>
<th>供应商网络</th>
<th>网卡2</th>
<th>硬件配置</th>
</tr>
</thead>
<tbody><tr>
<td align="center">controller</td>
<td>10.0.0.11</td>
<td>ens33</td>
<td>192.168.1.11</td>
<td>ens37</td>
<td>2c4g100g</td>
</tr>
<tr>
<td align="center">compute01</td>
<td>10.0.0.31</td>
<td>ens33</td>
<td>192.168.1.31</td>
<td>ens37</td>
<td>2c4g100g</td>
</tr>
</tbody></table>
<h1 id="二、基础环境的安装与配置"><a href="#二、基础环境的安装与配置" class="headerlink" title="二、基础环境的安装与配置"></a>二、基础环境的安装与配置</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="1、主机基础网络配置"><a href="#1、主机基础网络配置" class="headerlink" title="1、主机基础网络配置"></a>1、主机基础网络配置</h3><h4 id="（1）更换网络服务"><a href="#（1）更换网络服务" class="headerlink" title="（1）更换网络服务"></a>（1）更换网络服务</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在安装部署OpenStack时，OpenStack的网络服务会与NetworkManager服务产生冲突，二者无法一起正常工作，需要使用Network。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Network服务</span></span><br><span class="line">dnf install network-scripts -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停用NetworkManager并禁止开机自启</span></span><br><span class="line">systemctl stop NetworkManager &amp;&amp; systemctl <span class="builtin-name">disable</span> NetworkManager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用 Network并设置开机自启</span></span><br><span class="line">systemctl start<span class="built_in"> network </span>&amp;&amp; systemctl <span class="builtin-name">enable</span> network</span><br></pre></td></tr></table></figure>

<h4 id="（2）静态IP配置"><a href="#（2）静态IP配置" class="headerlink" title="（2）静态IP配置"></a>（2）静态IP配置</h4><p>需要注意在2张网卡配置中只保留一个网关，注释其他网卡的网关，此处也可以将网关配置为供应商的网络。</p>
<p>以下为控制节点网络配置，计算节点对照修改</p>
<h5 id="管理网络网卡ens33"><a href="#管理网络网卡ens33" class="headerlink" title="管理网络网卡ens33"></a>管理网络网卡ens33</h5><p>备份ifcfg-ens33文件</p>
<p><code>cp /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-ens33.bak</code></p>
<p>修改以下内容</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设为静态</span></span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设为开机自动连接</span></span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加IP、子网掩码、网关、DNS等</span></span><br><span class="line"><span class="comment"># add follow</span></span><br><span class="line"><span class="attribute">IPADDR</span>=<span class="string">&quot;10.0.0.11&quot;</span></span><br><span class="line"><span class="attribute">NETMASK</span>=<span class="string">&quot;255.255.255.0&quot;</span></span><br><span class="line"><span class="attribute">GATEWAY</span>=<span class="string">&quot;10.0.0.2&quot;</span></span><br><span class="line"><span class="attribute">DNS1</span>=<span class="string">&quot;10.0.0.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改后的配置：</span></span><br><span class="line">cat /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line"><span class="attribute">TYPE</span>=Ethernet</span><br><span class="line"><span class="attribute">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attribute">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">IPV6INIT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV6_AUTOCONF</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV6_DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV6_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">IPV6_ADDR_GEN_MODE</span>=stable-privacy</span><br><span class="line"><span class="attribute">NAME</span>=ens33</span><br><span class="line"><span class="attribute">DEVICE</span>=ens33</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPADDR</span>=10.0.0.11</span><br><span class="line"><span class="attribute">PREFIX</span>=24</span><br><span class="line"><span class="attribute">GATEWAY</span>=10.0.0.2</span><br><span class="line"><span class="attribute">DNS1</span>=10.0.0.2</span><br><span class="line"><span class="attribute">IPV6_PRIVACY</span>=<span class="literal">no</span></span><br></pre></td></tr></table></figure>

<h5 id="供应商网络网卡ens37"><a href="#供应商网络网卡ens37" class="headerlink" title="供应商网络网卡ens37"></a>供应商网络网卡ens37</h5><p>备份ifcfg-ens37文件</p>
<p><code>cp /etc/sysconfig/network-scripts/ifcfg-ens37 /etc/sysconfig/network-scripts/ifcfg-ens37.bak</code></p>
<p>修改以下内容</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设为静态</span></span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设为开机自动连接</span></span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加IP、子网掩码、网关、DNS等</span></span><br><span class="line"><span class="comment"># add follow</span></span><br><span class="line"><span class="attribute">IPADDR</span>=<span class="string">&quot;192.168.1.11&quot;</span></span><br><span class="line"><span class="attribute">NETMASK</span>=<span class="string">&quot;255.255.255.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改后的配置：</span></span><br><span class="line">cat /etc/sysconfig/network-scripts/ifcfg-ens37</span><br><span class="line"><span class="attribute">TYPE</span>=Ethernet</span><br><span class="line"><span class="attribute">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attribute">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">BOOTPROTO</span>=static</span><br><span class="line"><span class="attribute">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">IPV6INIT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV6_AUTOCONF</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV6_DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPV6_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attribute">IPV6_ADDR_GEN_MODE</span>=stable-privacy</span><br><span class="line"><span class="attribute">NAME</span>=ens37</span><br><span class="line"><span class="attribute">DEVICE</span>=ens37</span><br><span class="line"><span class="attribute">ONBOOT</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">IPADDR</span>=192.168.1.11</span><br><span class="line"><span class="attribute">PREFIX</span>=24</span><br><span class="line"><span class="attribute">IPV6_PRIVACY</span>=<span class="literal">no</span></span><br></pre></td></tr></table></figure>



<p>配置完成后，重启Network网络服务</p>
<p><code>systemctl restart network</code></p>
<h3 id="2、更换为国内yum源"><a href="#2、更换为国内yum源" class="headerlink" title="2、更换为国内yum源"></a>2、更换为国内yum源</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载阿里云源文件</span></span><br><span class="line">wget -O <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/CentOS-Base.repo https:/</span><span class="regexp">/mirrors.aliyun.com/</span>repo/Centos-<span class="number">8</span>.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换阿里云镜像地址</span></span><br><span class="line">sed -i -e <span class="string">&#x27;/mirrors.cloud.aliyuncs.com/d&#x27;</span> -e <span class="string">&#x27;/mirrors.aliyuncs.com/d&#x27;</span> <span class="regexp">/etc/yum</span>.repos.d/CentOS-Base.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立缓存</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h3 id="3、hostname主机名配置"><a href="#3、hostname主机名配置" class="headerlink" title="3、hostname主机名配置"></a>3、hostname主机名配置</h3><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">设置主机名</span><br><span class="line"><span class="string">hostnamectl</span> <span class="built_in">set-hostname</span> <span class="string">controller</span></span><br><span class="line"><span class="string">hostnamectl</span> <span class="built_in">set-hostname</span> <span class="string">compute1</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> &gt;&gt; /<span class="string">etc</span>/<span class="string">hosts</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="string">10</span>.<span class="string">0</span>.<span class="string">0</span>.<span class="string">11</span> <span class="string">controller</span></span><br><span class="line"><span class="string">10</span>.<span class="string">0</span>.<span class="string">0</span>.<span class="string">31</span> <span class="string">compute01</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h3 id="4、时间同步配置"><a href="#4、时间同步配置" class="headerlink" title="4、时间同步配置"></a>4、时间同步配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 控制节点</span></span><br><span class="line">cat &gt;&gt; /etc/chrony.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">allow 10.0.0.0/24</span></span><br><span class="line"><span class="string">server controller iburst</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算节点</span></span><br><span class="line">cat &gt;&gt; /etc/chrony.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">server controller iburst</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启chronyd服务</span></span><br><span class="line">systemctl restart chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证时间同步状态</span></span><br><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>

<h3 id="5、SSH免密登录配置"><a href="#5、SSH免密登录配置" class="headerlink" title="5、SSH免密登录配置"></a>5、SSH免密登录配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ansible免密登录playbook剧本配置</span></span><br><span class="line">[<span class="string">root@controller</span> <span class="string">~</span>]<span class="comment"># cat huxing.yaml </span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">openstack</span></span><br><span class="line">    <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">delete</span> <span class="string">/root/.ssh/</span></span><br><span class="line">       <span class="attr">file:</span> <span class="string">path=/root/.ssh/</span> <span class="string">state=absent</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">/root/.ssh/</span> <span class="string">dir</span></span><br><span class="line">       <span class="attr">file:</span> <span class="string">path=/root/.ssh/</span> <span class="string">mode=700</span> <span class="string">state=directory</span> <span class="string">owner=root</span> <span class="string">group=root</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">generating</span> <span class="string">public/private</span> <span class="string">rsa</span> <span class="string">key</span> <span class="string">pair</span> <span class="comment">#生成公钥和私钥</span></span><br><span class="line">       <span class="attr">shell:</span> <span class="string">ssh-keygen</span> <span class="string">-t</span> <span class="string">rsa</span> <span class="string">-b</span> <span class="number">2048</span> <span class="string">-N</span> <span class="string">&#x27;&#x27;</span> <span class="string">-f</span> <span class="string">/root/.ssh/id_rsa</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">delete</span> <span class="string">/tmp/ssh/</span> <span class="string">dir</span></span><br><span class="line">       <span class="attr">file:</span> <span class="string">path=/tmp/ssh/</span> <span class="string">state=absent</span></span><br><span class="line">       <span class="attr">connection:</span> <span class="string">local</span></span><br><span class="line">       <span class="attr">run_once:</span> <span class="literal">true</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">/tmp/ssh/</span> <span class="string">dir</span></span><br><span class="line">       <span class="attr">file:</span> <span class="string">path=/tmp/ssh/</span> <span class="string">state=directory</span></span><br><span class="line">       <span class="attr">run_once:</span> <span class="literal">true</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fetch</span> <span class="string">copy</span> <span class="comment">#从各宿主机将公钥拷贝到本机</span></span><br><span class="line">       <span class="attr">fetch:</span> <span class="string">src=/root/.ssh/id_rsa.pub</span> <span class="string">dest=/tmp/ssh/</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">append</span> <span class="string">file</span> <span class="string">authorized_keys.log</span> <span class="comment">#将各个公钥合并成一个文件</span></span><br><span class="line">       <span class="attr">shell:</span> <span class="string">find</span> <span class="string">/tmp/ssh/*</span> <span class="string">-type</span> <span class="string">f</span> <span class="string">-exec</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;cat &#123;&#125;&gt;&gt;/tmp/ssh/authorized_keys.log&#x27;</span> <span class="string">\;</span></span><br><span class="line">       <span class="attr">connection:</span> <span class="string">local</span></span><br><span class="line">       <span class="attr">run_once:</span> <span class="literal">true</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">authorized_keys</span> <span class="comment">#将合成的公钥进行分发</span></span><br><span class="line">       <span class="attr">copy:</span> <span class="string">src=/tmp/ssh/authorized_keys.log</span> <span class="string">dest=/root/.ssh/authorized_keys</span> <span class="string">mode=600</span></span><br><span class="line">       <span class="attr">tags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">install</span> <span class="string">ssh</span></span><br><span class="line"></span><br><span class="line"><span class="string">执行</span></span><br><span class="line"><span class="string">ansible-playbook</span> <span class="string">huxing.yaml</span> </span><br></pre></td></tr></table></figure>

<h3 id="6、禁用防火墙，关闭selinux"><a href="#6、禁用防火墙，关闭selinux" class="headerlink" title="6、禁用防火墙，关闭selinux"></a>6、禁用防火墙，关闭selinux</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">sed -i <span class="string">&#x27;/^SELINUX=.*/c SELINUX=disabled&#x27;</span> <span class="regexp">/etc/</span>selinux/config</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUXTYPE=.*/SELINUXTYPE=disabled/g&#x27;</span> <span class="regexp">/etc/</span>selinux/config</span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启生效selinux配置</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><h3 id="1、常用工具"><a href="#1、常用工具" class="headerlink" title="1、常用工具"></a>1、常用工具</h3><p><code>dnf install net-tools lsof wget iftop vim unzip zip -y</code></p>
<h3 id="2、OpenStack客户端工具"><a href="#2、OpenStack客户端工具" class="headerlink" title="2、OpenStack客户端工具"></a>2、OpenStack客户端工具</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装OpenStack v版存储仓库源</span></span><br><span class="line">dnf <span class="built_in">config</span>-manager --enable powertools</span><br><span class="line">dnf <span class="keyword">install </span>centos-release-openstack-victoria -y</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装openstack客户端工具【controller节点】</span></span><br><span class="line">dnf <span class="keyword">install </span>python3-openstackclient openstack-selinux -y</span><br></pre></td></tr></table></figure>

<p>以下各软件在控制节点安装即可</p>
<h3 id="3、数据库【controller节点】"><a href="#3、数据库【controller节点】" class="headerlink" title="3、数据库【controller节点】"></a>3、数据库【controller节点】</h3><p>安装Mariadb数据库，也可安装MySQL数据库</p>
<p><code>dnf install -y mariadb mariadb-server python3-PyMySQL</code><br>创建和编辑文件，添加如下信息</p>
<p><code>touch /etc/my.cnf.d/openstack.cnf</code><br><code>vim   /etc/my.cnf.d/openstack.cnf</code></p>
<p>文件内容如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">bind-address</span> = <span class="number">10.0</span>.<span class="number">0.11</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default-storage-engine</span> = innodb</span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="literal">on</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">4096</span></span><br><span class="line"><span class="attr">collation-server</span> = utf8_general_ci</span><br><span class="line"><span class="attr">character-set-server</span> = utf8</span><br></pre></td></tr></table></figure>


<p>启动数据库并设置为开机自启</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">systemctl</span> <span class="string">enable</span> <span class="string">mariadb</span>.<span class="string">service</span></span><br><span class="line"><span class="string">systemctl</span> <span class="string">start</span> <span class="string">mariadb</span>.<span class="string">service</span></span><br><span class="line"><span class="string">systemctl</span> <span class="string">status</span> <span class="string">mariadb</span>.<span class="string">service</span></span><br><span class="line"><span class="string">systemctl</span> <span class="built_in">list-unit-files</span> |<span class="string">grep</span> <span class="string">mariadb</span>.<span class="string">service</span></span><br></pre></td></tr></table></figure>

<p>配置mariadb数据库密码，执行</p>
<p><code>/usr/bin/mysql_secure_installation</code></p>
<p>依提示完成配置，测试环境中，设置密码为root，这里仅配置，相关的数据库在后面需要时再单独创建</p>
<p>测试一下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mariadb.service</span><br><span class="line">systemctl status mariadb.service</span><br><span class="line"></span><br><span class="line">mysql -uroot -proot</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br><span class="line">show databases;</span><br><span class="line">select user,host from mysql.user;</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="4、消息队列Rabbitmq【controller节点】"><a href="#4、消息队列Rabbitmq【controller节点】" class="headerlink" title="4、消息队列Rabbitmq【controller节点】"></a>4、消息队列Rabbitmq【controller节点】</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 安装软件包</span></span><br><span class="line">dnf install rabbitmq-server -y</span><br><span class="line"></span><br><span class="line"><span class="meta"># 启动消息队列服务并设置为开机自启</span></span><br><span class="line">systemctl enable rabbitmq-server.service</span><br><span class="line">systemctl start rabbitmq-server.service</span><br><span class="line">systemctl status rabbitmq-server.service</span><br><span class="line"></span><br><span class="line"><span class="meta"># 添加openstack用户并设置密码为111111</span></span><br><span class="line">rabbitmqctl add_user openstack <span class="number">111111</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 给openstack用户可读可写可配置权限</span></span><br><span class="line">rabbitmqctl set_permissions openstack <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span></span><br><span class="line">rabbitmqctl list_users </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># 为了方便监控，启用Web界面管理插件</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br><span class="line">rabbitmq-plugins list</span><br><span class="line"></span><br><span class="line"><span class="meta"># 安装成功后通过命令netstat -lntup查看多了一个15672的服务端口，</span></span><br><span class="line"><span class="meta"># 通过浏览器访问可以成功登录RabbitMQ，默认管理员账号guest，密码guest</span></span><br><span class="line">netstat -lntup</span><br><span class="line">lsof -i:<span class="number">15672</span></span><br></pre></td></tr></table></figure>

<h3 id="5、Memcached缓存【controller节点】"><a href="#5、Memcached缓存【controller节点】" class="headerlink" title="5、Memcached缓存【controller节点】"></a>5、Memcached缓存【controller节点】</h3><p>身份服务验证机制使用Memcached来缓存令牌。Memcached服务通常在控制节点上运行。</p>
<p>安装软件包</p>
<p><code>dnf install memcached python3-memcached -y</code></p>
<p>编辑vim /etc/sysconfig/memcached文件，将OPTTONS行修改成如下信息</p>
<p><code>OPTIONS=&quot;-l 127.0.0.1,::1,controller&quot;</code></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/</span>sysconfig/memcached&#123;,.bak&#125;</span><br><span class="line">sed -i <span class="string">&#x27;s|127.0.0.1,::1|127.0.0.1,::1,controller|g&#x27;</span> <span class="regexp">/etc/</span>sysconfig/memcached </span><br></pre></td></tr></table></figure>

<p>启动Memcached服务并设置开机自启</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">systemctl</span> <span class="string">restart</span> <span class="string">memcached</span>.<span class="string">service</span></span><br><span class="line"><span class="string">systemctl</span> <span class="string">enable</span> <span class="string">memcached</span>.<span class="string">service</span></span><br><span class="line"></span><br><span class="line"><span class="string">systemctl</span> <span class="string">status</span> <span class="string">memcached</span>.<span class="string">service</span></span><br><span class="line"><span class="string">netstat</span> -<span class="string">anptl</span>|<span class="string">grep</span> <span class="string">memcached</span></span><br><span class="line"><span class="string">systemctl</span> <span class="built_in">list-unit-files</span> |<span class="string">grep</span> <span class="string">memcached</span>.<span class="string">service</span></span><br></pre></td></tr></table></figure>

<h3 id="6、Etcd集群【controller节点】"><a href="#6、Etcd集群【controller节点】" class="headerlink" title="6、Etcd集群【controller节点】"></a>6、Etcd集群【controller节点】</h3><p>安装软件包</p>
<p><code>dnf install etcd -y</code></p>
<p>编辑etcd.conf配置文件</p>
<p><code>cp /etc/etcd/etcd.conf&#123;,.bak&#125;</code></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/etcd/etcd.conf &lt;&lt;EOF </span><br><span class="line"><span class="comment">#[Member]</span></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">&quot;http://10.0.0.11:2380&quot;</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;http://10.0.0.11:2379&quot;</span></span><br><span class="line">ETCD_NAME=<span class="string">&quot;controller&quot;</span></span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;http://10.0.0.11:2380&quot;</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;http://10.0.0.11:2379&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;controller=http://10.0.0.11:2380&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=<span class="string">&quot;etcd-cluster-01&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">&quot;new&quot;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>


<p>启动Etcd服务并设置开机自启</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">systemctl</span> <span class="string">restart</span> <span class="string">etcd</span>.<span class="string">service</span></span><br><span class="line"><span class="string">systemctl</span> <span class="string">enable</span> <span class="string">etcd</span>.<span class="string">service</span></span><br><span class="line"></span><br><span class="line"><span class="string">systemctl</span> <span class="string">status</span> <span class="string">etcd</span>.<span class="string">service</span></span><br><span class="line"><span class="string">netstat</span> -<span class="string">anptl</span>|<span class="string">grep</span> <span class="string">etcd</span></span><br><span class="line"><span class="string">systemctl</span> <span class="built_in">list-unit-files</span> |<span class="string">grep</span> <span class="string">etcd</span>.<span class="string">service</span></span><br></pre></td></tr></table></figure>

<h1 id="三、控制节点-安装keystone身份认证服务"><a href="#三、控制节点-安装keystone身份认证服务" class="headerlink" title="三、控制节点-安装keystone身份认证服务"></a>三、控制节点-安装keystone身份认证服务</h1><h2 id="1、创建keystone数据库并授权"><a href="#1、创建keystone数据库并授权" class="headerlink" title="1、创建keystone数据库并授权"></a>1、创建keystone数据库并授权</h2><p>（1）登录进入数据库</p>
<p>使用mysql数据库的root账户登录，密码为控制节点环境准备时初始化mysql数据设置的密码为root。</p>
<p><code>mysql -u root -proot</code></p>
<p>（2）创建keystone数据库并授权</p>
<p>创建keystone数据库,设置密码为111111，授予对keystone数据库的访问权限，刷新退出数据库.</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> keystone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">&#x27;keystone&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> \</span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> keystone.* <span class="keyword">TO</span> <span class="string">&#x27;keystone&#x27;</span>@<span class="string">&#x27;%&#x27;</span> \</span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush <span class="keyword">privileges</span>;</span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.<span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="2、keystone相关软件安装与配置"><a href="#2、keystone相关软件安装与配置" class="headerlink" title="2、keystone相关软件安装与配置"></a>2、keystone相关软件安装与配置</h2><h3 id="（1）安装keystone相关软件包"><a href="#（1）安装keystone相关软件包" class="headerlink" title="（1）安装keystone相关软件包"></a>（1）安装keystone相关软件包</h3><p>如果要使用https访问，需要安装mod_ssl</p>
<p><code>dnf install openstack-keystone httpd python3-mod_wsgi -y</code></p>
<h3 id="（2）修改-etc-keystone-keystone-conf文件"><a href="#（2）修改-etc-keystone-keystone-conf文件" class="headerlink" title="（2）修改/etc/keystone/keystone.conf文件"></a>（2）修改/etc/keystone/keystone.conf文件</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/</span>keystone/keystone.conf&#123;,.bak&#125;</span><br><span class="line"><span class="keyword">grep</span> -Ev <span class="string">&quot;^$|#&quot;</span> <span class="regexp">/etc/</span>keystone<span class="regexp">/keystone.conf.bak &gt; /</span>etc<span class="regexp">/keystone/</span>keystone.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[database\]/a\connection = mysql+pymysql://keystone:111111@controller/keystone&#x27;</span> <span class="regexp">/etc/</span>keystone/keystone.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[token\]/a\provider = fernet&#x27;</span> <span class="regexp">/etc/</span>keystone/keystone.conf</span><br></pre></td></tr></table></figure>

<h3 id="（3）初始化同步keystone数据库"><a href="#（3）初始化同步keystone数据库" class="headerlink" title="（3）初始化同步keystone数据库"></a>（3）初始化同步keystone数据库</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">su</span> -s /bin/sh -c <span class="string">&quot;keystone-manage db_sync&quot;</span> keystone同步完成，进行连接测试mysql  -ukeystone -p<span class="number">111111</span> -e <span class="string">&quot;use keystone;show tables;&quot;</span>mysql -h<span class="number">10.0.0.11</span> -ukeystone -p<span class="number">111111</span> -e <span class="string">&quot;use keystone;show tables;&quot;</span>|wc -l</span><br></pre></td></tr></table></figure>

<h3 id="（4）初始化Fernet令牌库"><a href="#（4）初始化Fernet令牌库" class="headerlink" title="（4）初始化Fernet令牌库"></a>（4）初始化Fernet令牌库</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage fernet_setup --keystone-<span class="keyword">user</span> <span class="title">keystone</span> --keystone-<span class="keyword">group</span> <span class="title">keystonekeystone-manage</span> credential_setup --keystone-<span class="keyword">user</span> <span class="title">keystone</span> --keystone-<span class="keyword">group</span> <span class="title">keystone</span></span><br></pre></td></tr></table></figure>

<h3 id="（5）初始化引导keystone认证服务"><a href="#（5）初始化引导keystone认证服务" class="headerlink" title="（5）初始化引导keystone认证服务"></a>（5）初始化引导keystone认证服务</h3><p><code>keystone-manage bootstrap --bootstrap-password 111111   --bootstrap-admin-url http://controller:5000/v3/   --bootstrap-internal-url http://controller:5000/v3/   --bootstrap-public-url http://controller:5000/v3/   --bootstrap-region-id RegionOne</code></p>
<h3 id="（6）配置启动Apache-Http服务"><a href="#（6）配置启动Apache-Http服务" class="headerlink" title="（6）配置启动Apache Http服务"></a>（6）配置启动Apache Http服务</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">编辑<span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>httpd.conf文件</span><br><span class="line">cp <span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>httpd.conf&#123;,.bak&#125;</span><br><span class="line">sed -i <span class="string">&quot;s/#ServerName www.example.com:80/ServerName controller/&quot;</span> <span class="regexp">/etc/</span>httpd<span class="regexp">/conf/</span>httpd.conf</span><br><span class="line"></span><br><span class="line">创建<span class="regexp">/usr/</span>share<span class="regexp">/keystone/</span>wsgi-keystone.conf文件链接</span><br><span class="line">ln -s <span class="regexp">/usr/</span>share<span class="regexp">/keystone/</span>wsgi-keystone.conf <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span></span><br><span class="line"></span><br><span class="line">启动httpd并配置开机自启动</span><br><span class="line">systemctl start httpd &amp;&amp; systemctl enable httpd</span><br><span class="line"></span><br><span class="line">netstat -anptl|<span class="keyword">grep</span> httpd</span><br><span class="line">systemctl list-unit-files |<span class="keyword">grep</span> httpd.service</span><br></pre></td></tr></table></figure>

<h3 id="（7）创建环境变量脚本"><a href="#（7）创建环境变量脚本" class="headerlink" title="（7）创建环境变量脚本"></a>（7）创建环境变量脚本</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; ~/admin-openrc.sh  &lt;&lt; EOF</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USER_DOMAIN_NAME</span>=Default</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PROJECT_NAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_USERNAME</span>=admin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_PASSWORD</span>=111111</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_AUTH_URL</span>=http://controller:5000/v3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IDENTITY_API_VERSION</span>=3</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">OS_IMAGE_API_VERSION</span>=2</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>附：常用的openstack管理命令，需要应用管理员的环境变量</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看keystone实例相关信息</span></span><br><span class="line">openstack endpoint list</span><br><span class="line">openstack project list</span><br><span class="line">openstack <span class="keyword">user</span> <span class="title">list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除endpoint</span></span><br><span class="line">openstack endpoint delete [ID]</span><br></pre></td></tr></table></figure>

<h3 id="（8）创建keystone的一般实例"><a href="#（8）创建keystone的一般实例" class="headerlink" title="（8）创建keystone的一般实例"></a>（8）创建keystone的一般实例</h3><p><code>source ./admin-openrc.sh</code><br><code>openstack catalog list</code></p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">（1）【非必须】 创建一个名为example的域</span><br><span class="line"></span><br><span class="line">创建域，程序中已存在默认域，此命令只是一个创建域的例子，可以不执行</span><br><span class="line">#openstack domain <span class="keyword">create</span> --description <span class="string">&quot;An Example Domain&quot;</span> example</span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）【必须】 创建名为service的项目，也叫做租户,在default域中。</span><br><span class="line">openstack project <span class="keyword">create</span> --domain default --description <span class="string">&quot;Service Project&quot;</span> service</span><br><span class="line"></span><br><span class="line">（<span class="number">3</span>）【非必须】 创建名为myproject项目，在default域中。</span><br><span class="line">#openstack project <span class="keyword">create</span> --domain default --description <span class="string">&quot;Demo Project&quot;</span> myproject</span><br><span class="line"></span><br><span class="line">（<span class="number">4</span>）【非必须】 创建myuser用户，在default域中。</span><br><span class="line">以下命令会在local_user表增加myuser用户。使用–<span class="keyword">password</span>选项为直接配置明文密码，使用–<span class="keyword">password</span>-prompt选项为交互式输入密码,直接创建用户和密码.</span><br><span class="line">#openstack <span class="keyword">user</span> <span class="keyword">create</span> --domain default --<span class="keyword">password</span>-prompt myuser</span><br><span class="line"></span><br><span class="line">执行命令后需要设置用户密码，输入两次相同的密码</span><br><span class="line"></span><br><span class="line">（<span class="number">5</span>）【非必须】 创建myrole角色，在<span class="keyword">role</span>表中。</span><br><span class="line"></span><br><span class="line"># openstack <span class="keyword">role</span> <span class="keyword">create</span> myrole</span><br><span class="line"></span><br><span class="line">（<span class="number">6</span>）**【非必须】**将myrole角色添加到myproject项目和myuser用户</span><br><span class="line">#openstack <span class="keyword">role</span> add --project myproject --<span class="keyword">user</span> myuser myrole</span><br><span class="line"></span><br><span class="line">（<span class="number">7</span>）查看keystone实例相关信息</span><br><span class="line">source admin-openrc.sh </span><br><span class="line">openstack <span class="keyword">role</span> list</span><br><span class="line">openstack endpoint list</span><br><span class="line">openstack project list</span><br><span class="line">openstack <span class="keyword">user</span> list</span><br></pre></td></tr></table></figure>

<h3 id="（9）验证操作keystone是否安装配置成功"><a href="#（9）验证操作keystone是否安装配置成功" class="headerlink" title="（9）验证操作keystone是否安装配置成功"></a>（9）验证操作keystone是否安装配置成功</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">验证KeyStone服务是否正常</span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack token issue</span></span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> Field      </span>|<span class="string"> Value                                                                                                                                                                                   </span>|</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">|<span class="string"> expires    </span>|<span class="string"> 2021-05-31T09:55:26+0000                                                                                                                                                                </span>|</span><br><span class="line">|<span class="string"> id         </span>|<span class="string"> gAAAAABgtKR-1fiww05fehawZ532h8sbf5Jcwfo4kGd58w6zkC_zdilNW7f50yjf-EFEUMDCw-kaUXVs-6T9r0LKeR26oeyqJ5ywYP3G0fYnQedcVun6xUBWfT_CH_OEhN7XjuLfdCKB4Udx2nSTKfwOoSEAXAtsa4ry0jpTjB18yUN46mrvNYg </span>|</span><br><span class="line">|<span class="string"> project_id </span>|<span class="string"> 1f3f5e0c452d49d4a1ca013f5a89f8fe                                                                                                                                                        </span>|</span><br><span class="line">|<span class="string"> user_id    </span>|<span class="string"> db375734fa174365bfbd2640ee14383b                                                                                                                                                        </span>|</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">出现如以上信息就说明KeyStone配置成功</span><br></pre></td></tr></table></figure>

<h1 id="四、控制节点-安装glance镜像服务"><a href="#四、控制节点-安装glance镜像服务" class="headerlink" title="四、控制节点-安装glance镜像服务"></a>四、控制节点-安装glance镜像服务</h1><h2 id="1、创建glance数据库并授权"><a href="#1、创建glance数据库并授权" class="headerlink" title="1、创建glance数据库并授权"></a>1、创建glance数据库并授权</h2><p>（1）使用mysql数据库的root账户登录</p>
<p>密码为控制节点环境准备时初始化mysql数据设置的密码为root。</p>
<p><code>mysql -u root -proot</code><br>（2）创建glance数据库并授权,设置密码为111111。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> glance;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> glance.* <span class="keyword">TO</span> <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;flush <span class="keyword">privileges</span>;<span class="keyword">show</span> databases;<span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.<span class="keyword">user</span>;<span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="2-创建服务凭据"><a href="#2-创建服务凭据" class="headerlink" title="2.创建服务凭据"></a>2.创建服务凭据</h2><h3 id="（1）在keystone上创建glance用户"><a href="#（1）在keystone上创建glance用户" class="headerlink" title="（1）在keystone上创建glance用户"></a>（1）在keystone上创建glance用户</h3><p>以下命令将在local_user表创建glance用户</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source admin-openrc.sh openstack <span class="keyword">user</span> <span class="title">create</span> --domain default --<span class="attr">password=</span><span class="number">111111</span> glanceopenstack <span class="keyword">user</span> <span class="title">list</span></span><br></pre></td></tr></table></figure>

<h3 id="（2）在keystone上将glance用户添加为service项目的admin角色-权限"><a href="#（2）在keystone上将glance用户添加为service项目的admin角色-权限" class="headerlink" title="（2）在keystone上将glance用户添加为service项目的admin角色(权限)"></a>（2）在keystone上将glance用户添加为service项目的admin角色(权限)</h3><p>以下命令无输出</p>
<p><code>openstack role add --project service --user glance admin</code></p>
<h3 id="（3）创建glance镜像服务的实体"><a href="#（3）创建glance镜像服务的实体" class="headerlink" title="（3）创建glance镜像服务的实体"></a>（3）创建glance镜像服务的实体</h3><p>以下命令在service表中增加glance项目</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">openstack</span> <span class="string">service</span> <span class="string">create</span> <span class="built_in">--name</span> <span class="string">glance</span> <span class="built_in">--description</span> <span class="string">&quot;OpenStack Image&quot;</span> <span class="string">imageopenstack</span> <span class="string">service</span> <span class="string">list</span></span><br></pre></td></tr></table></figure>

<h3 id="（4）创建镜像服务的-API-端点（endpoint）"><a href="#（4）创建镜像服务的-API-端点（endpoint）" class="headerlink" title="（4）创建镜像服务的 API 端点（endpoint）"></a>（4）创建镜像服务的 API 端点（endpoint）</h3><p>【这里会影响API的调用】<br>以下命令会在endpoint表增加3条项目</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne image public http:<span class="regexp">//</span>controller:<span class="number">9292</span>openstack endpoint create --region RegionOne image internal http:<span class="regexp">//</span>controller:<span class="number">9292</span>openstack endpoint create --region RegionOne image admin http:<span class="regexp">//</span>controller:<span class="number">9292</span>openstack endpoint list</span><br></pre></td></tr></table></figure>

<p>至此，glance在keystone上面注册完成，下面可以进行安装</p>
<h2 id="3、glance相关软件安装与配置"><a href="#3、glance相关软件安装与配置" class="headerlink" title="3、glance相关软件安装与配置"></a>3、glance相关软件安装与配置</h2><h3 id="（1）安装glance软件"><a href="#（1）安装glance软件" class="headerlink" title="（1）安装glance软件"></a>（1）安装glance软件</h3><p><code>dnf install openstack-glance -y</code></p>
<h3 id="（2）配置文件修改"><a href="#（2）配置文件修改" class="headerlink" title="（2）配置文件修改"></a>（2）配置文件修改</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/g</span>lance<span class="regexp">/glance-api.conf&#123;,.bak&#125;cp -a /</span>etc<span class="regexp">/glance/g</span>lance-registry.conf&#123;,.bak&#125;grep -Ev <span class="string">&#x27;^$|#&#x27;</span> <span class="regexp">/etc/g</span>lance<span class="regexp">/glance-api.conf.bak &gt; /</span>etc<span class="regexp">/glance/g</span>lance-api.confgrep -Ev <span class="string">&#x27;^$|#&#x27;</span> <span class="regexp">/etc/g</span>lance<span class="regexp">/glance-registry.conf.bak &gt; /</span>etc<span class="regexp">/glance/g</span>lance-registry.confsed -i <span class="string">&#x27;/\[database\]/a\connection = mysql+pymysql://glance:111111@controller/glance&#x27;</span> <span class="regexp">/etc/g</span>lance<span class="regexp">/glance-api.confsed -i &#x27;/</span>\[glance_store\]<span class="regexp">/a\filesystem_store_datadir = /</span>var<span class="regexp">/lib/g</span>lance<span class="regexp">/images/</span><span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[glance_store\]/</span>a\default_store = file<span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[glance_store\]/</span>a\stores = file,http<span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\password = <span class="number">111111</span><span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\username = glance<span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\project_name = service<span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\user_domain_name = Default<span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\project_domain_name = Default<span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\auth_type = password<span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\memcached_servers = controller:<span class="number">11211</span><span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\auth_url = http:<span class="regexp">//</span>controller:<span class="number">5000</span><span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\www_authenticate_uri = http:<span class="regexp">//</span>controller:<span class="number">5000</span><span class="string">&#x27; /etc/glance/glance-api.confsed -i &#x27;</span><span class="regexp">/\[paste_deploy\]/</span>a\flavor = keystone<span class="string">&#x27; /etc/glance/glance-api.conf</span></span><br></pre></td></tr></table></figure>

<h3 id="（3）同步glance数据库"><a href="#（3）同步glance数据库" class="headerlink" title="（3）同步glance数据库"></a>（3）同步glance数据库</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为glance镜像服务初始化同步数据库，生成的相关表su -s <span class="regexp">/bin/</span>sh -c <span class="string">&quot;glance-manage db_sync&quot;</span> glance忽略输出的内容,最后结果为：Database is synced successfully.同步完成进行连接测试保证所有需要的表已经建立，否则后面可能无法进行下去mysql -uglance -p111111 -e <span class="string">&quot;use glance;show tables;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="（4）glance镜像服务启动并设置开机自启"><a href="#（4）glance镜像服务启动并设置开机自启" class="headerlink" title="（4）glance镜像服务启动并设置开机自启"></a>（4）glance镜像服务启动并设置开机自启</h3><p>systemctl start openstack-glance-api &amp;&amp; systemctl enable openstack-glance-api</p>
<h3 id="（5）镜像上传验证"><a href="#（5）镜像上传验证" class="headerlink" title="（5）镜像上传验证"></a>（5）镜像上传验证</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">下载一个测试镜像先上传到系统中，然后上传到glance服务</span><br><span class="line"></span><br><span class="line">1.下载镜像</span><br><span class="line">wget http:<span class="string">//download.cirros-cloud.net/0.5.0/cirros-0.5.0-x86_64-disk.img</span></span><br><span class="line">wget http:<span class="string">//download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span></span><br><span class="line">wget http:<span class="string">//download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img</span></span><br><span class="line">3.上传镜像</span><br><span class="line">使用qcow2磁盘格式， bare容器格式上传镜像到镜像服务并设置公共可见，这样所有的项目都可以访问它</span><br><span class="line">glance image-create <span class="params">--name</span> <span class="string">&quot;cirros-0.5.0&quot;</span> <span class="params">--file</span> <span class="string">./cirros-0.5.0-x86_64-disk.img</span>  <span class="params">--disk-format</span> qcow2 <span class="params">--container-format</span> bare  <span class="params">--visibility</span> public</span><br><span class="line">glance image-create <span class="params">--name</span> <span class="string">&quot;cirros-0.4.0&quot;</span> <span class="params">--file</span> <span class="string">./cirros-0.4.0-x86_64-disk.img</span>  <span class="params">--disk-format</span> qcow2 <span class="params">--container-format</span> bare  <span class="params">--visibility</span> public</span><br><span class="line">openstack image create <span class="string">&quot;cirros-0.3.5&quot;</span>  <span class="params">--file</span> <span class="string">./cirros-0.3.5-x86_64-disk.img</span> <span class="params">--disk-format</span> qcow2 <span class="params">--container-format</span> bare <span class="params">--public</span></span><br><span class="line">4.查看镜像信息</span><br><span class="line">openstack image list</span><br><span class="line"></span><br><span class="line">在<span class="string">/var/lib/glance/images/</span>目录下可以看到镜像文件，如果要删除此镜像需要删除数据库信息，再删除镜像文件</span><br><span class="line"><span class="keyword">ls</span> <span class="string">/var/lib/glance/images/</span></span><br><span class="line">镜像信息都是存在glance数据库中的，我们可以在glance库中的images表看到上传的镜像信息.</span><br></pre></td></tr></table></figure>

<h1 id="五、控制节点-Placement服务组件"><a href="#五、控制节点-Placement服务组件" class="headerlink" title="五、控制节点-Placement服务组件"></a>五、控制节点-Placement服务组件</h1><p>Placement服务的作用是跟踪资源（如计算节点，存储资源池，网络资源池等）的使用情况，提供自定义资源的能力，为分配资源提供服务。Placement在openstack的Stein版本之前是属于Nova组件的一部分。</p>
<p>在安装Nova之前需要先安装此组件。</p>
<h2 id="1、创建placement数据库并授权"><a href="#1、创建placement数据库并授权" class="headerlink" title="1、创建placement数据库并授权"></a>1、创建placement数据库并授权</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 使用mysql数据库的root账户登录，密码为控制节点环境准备时初始化mysql数据设置的密码为root。</span><br><span class="line">mysql -u root -proot</span><br><span class="line"></span><br><span class="line"># 创建placement数据库并授权,设置密码为<span class="number">111111</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> placement;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> placement.* <span class="keyword">TO</span> <span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush <span class="keyword">privileges</span>;</span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.<span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="2、创建服务凭据"><a href="#2、创建服务凭据" class="headerlink" title="2、创建服务凭据"></a>2、创建服务凭据</h2><p>同glance一样，创建并注册该项目的服务证书、域用户、项目、实体</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个plancement用户并设置密码为111111</span></span><br><span class="line">openstack user create <span class="params">--domain</span> default <span class="params">--password</span> 111111 placement</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用admin角色将Placement用户添加到服务项目中</span></span><br><span class="line">openstack role add <span class="params">--project</span> service <span class="params">--user</span> placement admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Plancement服务</span></span><br><span class="line">openstack service create <span class="params">--name</span> placement <span class="params">--description</span> <span class="string">&quot;Placement API&quot;</span> placement</span><br><span class="line">openstack service list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建placement项目的endpoint（API端口）</span></span><br><span class="line">openstack endpoint create <span class="params">--region</span> RegionOne placement public http:<span class="string">//controller</span><span class="function">:8778</span></span><br><span class="line">openstack endpoint create <span class="params">--region</span> RegionOne placement internal http:<span class="string">//controller</span><span class="function">:8778</span></span><br><span class="line">openstack endpoint create <span class="params">--region</span> RegionOne placement admin http:<span class="string">//controller</span><span class="function">:8778</span></span><br><span class="line">openstack endpoint list</span><br></pre></td></tr></table></figure>

<h2 id="3、placement相关软件安装与配置"><a href="#3、placement相关软件安装与配置" class="headerlink" title="3、placement相关软件安装与配置"></a>3、placement相关软件安装与配置</h2><h3 id="（1）安装placement软件"><a href="#（1）安装placement软件" class="headerlink" title="（1）安装placement软件"></a>（1）安装placement软件</h3><p><code>dnf install openstack-placement-api -y</code></p>
<h3 id="（2）配置文件修改-1"><a href="#（2）配置文件修改-1" class="headerlink" title="（2）配置文件修改"></a>（2）配置文件修改</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/</span>placement<span class="regexp">/placement.conf&#123;,.bak&#125;grep -Ev &#x27;^$|#&#x27; /</span>etc<span class="regexp">/placement/</span>placement.conf.bak &gt; <span class="regexp">/etc/</span>placement<span class="regexp">/placement.confsed -i &#x27;/</span>\[placement_database\]<span class="regexp">/a\connection = mysql+pymysql:/</span><span class="regexp">/placement:111111@controller/</span>placement<span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[api\]/</span>a\auth_strategy = keystone<span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\password = <span class="number">111111</span><span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\username = placement<span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\project_name = service<span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\user_domain_name = Default<span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\project_domain_name = Default<span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\auth_type = password<span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\memcached_servers = controller:<span class="number">11211</span><span class="string">&#x27; /etc/placement/placement.confsed -i &#x27;</span><span class="regexp">/\[keystone_authtoken\]/</span>a\auth_url = http:<span class="regexp">//</span>controller:<span class="number">5000</span><span class="regexp">/v3&#x27; /</span>etc<span class="regexp">/placement/</span>placement.conf修改placement的apache配置文件（官方文档坑点之一，这个步骤官方文档没有提到，如果不做，后面计算服务检查时将会报错）cat &gt;&gt;<span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span><span class="number">00</span>-placement-api.conf&lt;&lt;EOF&lt;Directory <span class="regexp">/usr/</span>bin&gt;   &lt;IfVersion &gt;= <span class="number">2.4</span>&gt;      Require all granted   &lt;<span class="regexp">/IfVersion&gt;   &lt;IfVersion &lt; 2.4&gt;      Order allow,deny      Allow from all   &lt;/</span>IfVersion&gt;&lt;/Directory&gt;EOF</span><br></pre></td></tr></table></figure>

<h3 id="（3）同步placement数据库"><a href="#（3）同步placement数据库" class="headerlink" title="（3）同步placement数据库"></a>（3）同步placement数据库</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -s <span class="regexp">/bin/</span>sh -c <span class="string">&quot;placement-manage db sync&quot;</span> placementmysql -uplacement -p111111 -e <span class="string">&quot;use placement;show tables;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="（4）重启Apache服务（httpd）"><a href="#（4）重启Apache服务（httpd）" class="headerlink" title="（4）重启Apache服务（httpd）"></a>（4）重启Apache服务（httpd）</h3><p>如果重启失败，注意防火墙配置</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">restart</span> httpdsystemctl <span class="built_in">status</span> httpd</span><br></pre></td></tr></table></figure>

<h3 id="（5）检查Placement服务状态"><a href="#（5）检查Placement服务状态" class="headerlink" title="（5）检查Placement服务状态"></a>（5）检查Placement服务状态</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# placement-status upgrade check</span><br><span class="line"><span class="code">+----------------------------------+</span></span><br><span class="line"><span class="section">| Upgrade Check Results            |</span></span><br><span class="line"><span class="section">+----------------------------------+</span></span><br><span class="line">| Check: Missing Root Provider IDs |</span><br><span class="line">| Result: Success                  |</span><br><span class="line"><span class="section">| Details: None                    |</span></span><br><span class="line"><span class="section">+----------------------------------+</span></span><br><span class="line">| Check: Incomplete Consumers      |</span><br><span class="line">| Result: Success                  |</span><br><span class="line"><span class="section">| Details: None                    |</span></span><br><span class="line"><span class="section">+----------------------------------+</span></span><br></pre></td></tr></table></figure>

<h1 id="六、控制节点-Nova计算服务组件"><a href="#六、控制节点-Nova计算服务组件" class="headerlink" title="六、控制节点-Nova计算服务组件"></a>六、控制节点-Nova计算服务组件</h1><h2 id="1、创建数据库并授权"><a href="#1、创建数据库并授权" class="headerlink" title="1、创建数据库并授权"></a>1、创建数据库并授权</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -proot</span><br><span class="line"></span><br><span class="line"># 需要创建<span class="number">3</span>个数据库，分别是：nova_api，nova，nova_cell0，设置密码为<span class="number">111111</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_api;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> nova_cell0;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_api.* <span class="keyword">TO</span> <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova.* <span class="keyword">TO</span> <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> nova_cell0.* <span class="keyword">TO</span> <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush <span class="keyword">privileges</span>;</span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.<span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="2、创建计算服务凭据"><a href="#2、创建计算服务凭据" class="headerlink" title="2、创建计算服务凭据"></a>2、创建计算服务凭据</h2><h3 id="（1）在keystone上创建nova用户"><a href="#（1）在keystone上创建nova用户" class="headerlink" title="（1）在keystone上创建nova用户"></a>（1）在keystone上创建nova用户</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">user</span> <span class="title">create</span> --domain default --<span class="attr">password=</span><span class="number">111111</span> nova</span><br><span class="line">openstack <span class="keyword">user</span> <span class="title">list</span></span><br></pre></td></tr></table></figure>

<h3 id="（2）在keystone上将nova用户，配置为admin角色，并添加进service项目"><a href="#（2）在keystone上将nova用户，配置为admin角色，并添加进service项目" class="headerlink" title="（2）在keystone上将nova用户，配置为admin角色，并添加进service项目"></a>（2）在keystone上将nova用户，配置为admin角色，并添加进service项目</h3><p><code>openstack role add --project service --user nova admin</code></p>
<h3 id="（3）创建nova计算服务的实体"><a href="#（3）创建nova计算服务的实体" class="headerlink" title="（3）创建nova计算服务的实体"></a>（3）创建nova计算服务的实体</h3><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">openstack</span> <span class="string">service</span> <span class="string">create</span> <span class="built_in">--name</span> <span class="string">nova</span> <span class="built_in">--description</span> <span class="string">&quot;OpenStack Compute&quot;</span> <span class="string">compute</span></span><br><span class="line"><span class="string">openstack</span> <span class="string">service</span> <span class="string">list</span></span><br></pre></td></tr></table></figure>

<h3 id="（4）创建compute-API服务端点"><a href="#（4）创建compute-API服务端点" class="headerlink" title="（4）创建compute API服务端点"></a>（4）创建compute API服务端点</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">openstack</span> endpoint create --region RegionOne compute public http://controller:<span class="number">8774</span>/v<span class="number">2</span>.<span class="number">1</span>openstack endpoint create --region RegionOne compute internal http://controller:<span class="number">8774</span>/v<span class="number">2</span>.<span class="number">1</span>openstack endpoint create --region RegionOne compute admin http://controller:<span class="number">8774</span>/v<span class="number">2</span>.<span class="number">1</span>openstack endpoint list</span><br></pre></td></tr></table></figure>

<h2 id="3、nova相关软件安装与配置"><a href="#3、nova相关软件安装与配置" class="headerlink" title="3、nova相关软件安装与配置"></a>3、nova相关软件安装与配置</h2><h3 id="（1）安装nova相关软件"><a href="#（1）安装nova相关软件" class="headerlink" title="（1）安装nova相关软件"></a>（1）安装nova相关软件</h3><p>dnf install openstack-nova-api openstack-nova-conductor openstack-nova-novncproxy openstack-nova-scheduler -y</p>
<h3 id="（2）配置文件修改-2"><a href="#（2）配置文件修改-2" class="headerlink" title="（2）配置文件修改"></a>（2）配置文件修改</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/</span>nova/nova.conf&#123;,.bak&#125;</span><br><span class="line"><span class="keyword">grep</span> -Ev <span class="string">&#x27;^$|#&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.conf.bak &gt; /</span>etc<span class="regexp">/nova/</span>nova.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\firewall_driver = nova.virt.firewall.NoopFirewallDriver&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\use_neutron = true&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\my_ip = 10.1.1.100&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\transport_url = rabbit://openstack:111111@controller&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\enabled_apis = osapi_compute,metadata&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[api\]/a\auth_strategy = keystone&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[api_database\]/a\connection = mysql+pymysql://nova:111111@controller/nova_api&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[database\]/a\connection = mysql+pymysql://nova:111111@controller/nova&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[placement_database\]/a\connection = mysql+pymysql://placement:111111@controller/placement&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\password = 111111&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\username = nova&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\project_name = service&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\user_domain_name = Default&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\project_domain_name = Default&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\auth_type = password&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\memcached_servers = controller:11211&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\auth_url = http://controller:5000/v3&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[vnc\]/a\server_proxyclient_address = $my_ip&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[vnc\]/a\server_listen = $my_ip&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[vnc\]/a\enabled = true&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[glance\]/a\api_servers = http://controller:9292&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[oslo_concurrency\]/a\lock_path = /var/lib/nova/tmp&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\password = 111111&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\username = placement&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\auth_url = http://controller:5000/v3&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\user_domain_name = Default&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\auth_type = password&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\project_name = service&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\project_domain_name = Default&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[placement\]/a\region_name = RegionOne&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[scheduler\]/a\discover_hosts_in_cells_interval = 300&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br></pre></td></tr></table></figure>

<h3 id="（3）同步并创建相关数据库（注意顺序）"><a href="#（3）同步并创建相关数据库（注意顺序）" class="headerlink" title="（3）同步并创建相关数据库（注意顺序）"></a>（3）同步并创建相关数据库（注意顺序）</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">（1）同步nova-api数据库</span><br><span class="line">su -s <span class="string">/bin/sh</span> -c <span class="string">&quot;nova-manage api_db sync&quot;</span> nova</span><br><span class="line"></span><br><span class="line">mysql -unova -p111111 -e <span class="string">&quot;use nova_api;show tables;&quot;</span></span><br><span class="line"></span><br><span class="line">（2）同步cell0数据库</span><br><span class="line">su -s <span class="string">/bin/sh</span> -c <span class="string">&quot;nova-manage cell_v2 map_cell0&quot;</span> nova</span><br><span class="line"></span><br><span class="line">（3）创建cell1单元</span><br><span class="line">su -s <span class="string">/bin/sh</span> -c <span class="string">&quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot;</span> nova</span><br><span class="line"></span><br><span class="line">可以忽略输出的warning信息</span><br><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova</span></span><br><span class="line"><span class="params">--transport-url</span> not provided in the <span class="keyword">command</span> line, using the value [DEFAULT]<span class="string">/transport_url</span> from the configuration file</span><br><span class="line"><span class="params">--database_connection</span> not provided in the <span class="keyword">command</span> line, using the value [database]<span class="string">/connection</span> from the configuration file</span><br><span class="line">55f5aa33-bb10-4965-8200-a1277413b824</span><br><span class="line"></span><br><span class="line">（4）初始化同步nova数据库</span><br><span class="line">su -s <span class="string">/bin/sh</span> -c <span class="string">&quot;nova-manage db sync&quot;</span> nova</span><br><span class="line"></span><br><span class="line">（5）验证nova_cell0和cell1是否添加成功</span><br><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova</span></span><br><span class="line">+<span class="params">-------</span>+<span class="params">--------------------------------------</span>+<span class="params">------------------------------------</span>+<span class="params">-------------------------------------------------</span>+<span class="params">----------</span>+</span><br><span class="line">|  Name |                 UUID                 |           Transport URL            |               Database Connection               | Disabled |</span><br><span class="line">+<span class="params">-------</span>+<span class="params">--------------------------------------</span>+<span class="params">------------------------------------</span>+<span class="params">-------------------------------------------------</span>+<span class="params">----------</span>+</span><br><span class="line">| cell0 | 00000000-0000-0000-0000-000000000000 |               none:/               | mysql+pymysql:<span class="string">//nova</span>:****@controller/nova_cell0 |  False   |</span><br><span class="line">| cell1 | 55f5aa33-bb10-4965-8200-a1277413b824 | rabbit:<span class="string">//openstack</span>:****@controller |    mysql+pymysql:<span class="string">//nova</span>:****@controller/nova    |  False   |</span><br><span class="line">+<span class="params">-------</span>+<span class="params">--------------------------------------</span>+<span class="params">------------------------------------</span>+<span class="params">-------------------------------------------------</span>+<span class="params">----------</span>+</span><br><span class="line"></span><br><span class="line">（6）验证数据库</span><br><span class="line">mysql -unova -p111111 -e <span class="string">&quot;use nova_api;show tables;&quot;</span></span><br><span class="line">mysql -uplacement -p111111 -e <span class="string">&quot;use placement;show tables;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="（4）启动计算服并设置开机自启"><a href="#（4）启动计算服并设置开机自启" class="headerlink" title="（4）启动计算服并设置开机自启"></a>（4）启动计算服并设置开机自启</h3><p>systemctl start openstack-nova-api openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy<br>systemctl enable openstack-nova-api openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy</p>
<h3 id="（5）验证服务是否成功启动"><a href="#（5）验证服务是否成功启动" class="headerlink" title="（5）验证服务是否成功启动"></a>（5）验证服务是否成功启动</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# nova service-list+--------------------------------------+----------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+| <span class="type">Id</span>                                   | <span class="type">Binary</span>         | <span class="type">Host</span>       | <span class="type">Zone</span>     | <span class="type">Status</span>  | <span class="type">State</span> | <span class="type">Updated_at</span>                 | <span class="type">Disabled</span> Reason | <span class="type">Forced</span> down |<span class="type">+--------------------------------------+----------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+| a34a501d</span><span class="number">-40</span>c1<span class="number">-4</span>f71<span class="number">-9e53</span><span class="number">-482e8</span>d1179d5 | <span class="type">nova</span>-conductor | <span class="type">controller</span> | <span class="type">internal</span> | <span class="type">enabled</span> | <span class="type">up</span>    | <span class="type">2021</span><span class="number">-06</span><span class="number">-01</span>T00:<span class="number">45</span>:<span class="number">29.000000</span> | <span class="type">-               | False</span>       |<span class="type">| 660c4170</span><span class="number">-2789</span><span class="number">-4</span>dab<span class="number">-96</span>dd<span class="number">-41</span>a5264b1ab2 | <span class="type">nova</span>-scheduler | <span class="type">controller</span> | <span class="type">internal</span> | <span class="type">enabled</span> | <span class="type">up</span>    | <span class="type">2021</span><span class="number">-06</span><span class="number">-01</span>T00:<span class="number">45</span>:<span class="number">31.000000</span> | <span class="type">-               | False</span>       |<span class="type">+--------------------------------------+----------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+ [root</span>@controller ~]# netstat -lntup | <span class="type">grep</span> <span class="number">6080</span>tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">6080</span>            <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      <span class="number">2910</span>/python3[root@controller ~]# systemctl list-unit-files |<span class="type">grep</span> openstack-nova* |<span class="type">grep</span> enabledopenstack-nova-api.service             enabled  openstack-nova-conductor.service       enabled  openstack-nova-novncproxy.service      enabled  openstack-nova-scheduler.service       enabled  </span><br></pre></td></tr></table></figure>

<p>启动了4个服务，为什么只看到2个服务呢？</p>
<p>这是因为nova service-list这个命令是发给openstack-nova-api的，由openstack-nova-api服务返回响应结果，若nova-api服务关闭了，openstack-nova-scheduler和openstack-nova-conductor两个服务便无法启动；而查看openstack-nova-novncproxy服务是启动成功，是通过端口查看的，netstat -lntup | grep 6080，查看进程ps -ef | grep 上条命令得到的进程号。</p>
<p>启动novncproxy服务后，便可以通过Web访问<a target="_blank" rel="noopener" href="http://10.0.0.11:6080/">http://10.0.0.11:6080</a> ，来进入noVNC页面，只是还没有连接云主机</p>
<p>至此，控制节点Nova服务安装完成</p>
<h1 id="七、计算节点-Nova计算服务组件"><a href="#七、计算节点-Nova计算服务组件" class="headerlink" title="七、计算节点-Nova计算服务组件"></a>七、计算节点-Nova计算服务组件</h1><h2 id="1、nova相关软件安装与配置"><a href="#1、nova相关软件安装与配置" class="headerlink" title="1、nova相关软件安装与配置"></a>1、nova相关软件安装与配置</h2><h3 id="（1）安装nova相关软件-1"><a href="#（1）安装nova相关软件-1" class="headerlink" title="（1）安装nova相关软件"></a>（1）安装nova相关软件</h3><p><code>dnf install openstack-nova-compute -y</code></p>
<h3 id="（2）配置文件修改-3"><a href="#（2）配置文件修改-3" class="headerlink" title="（2）配置文件修改"></a>（2）配置文件修改</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/</span>nova<span class="regexp">/nova.conf&#123;,.bak&#125;grep -Ev &#x27;^$|#&#x27; /</span>etc<span class="regexp">/nova/</span>nova.conf.bak &gt; <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[DEFAULT\]<span class="regexp">/a\firewall_driver = nova.virt.firewall.NoopFirewallDriver&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[DEFAULT\]/a\use_neutron = true&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[DEFAULT\]<span class="regexp">/a\my_ip = 10.0.0.31&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[DEFAULT\]/a\transport_url = rabbit://openstack:111111@controller&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[DEFAULT\]<span class="regexp">/a\enabled_apis = osapi_compute,metadata&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[api\]/a\auth_strategy = keystone&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[keystone_authtoken\]<span class="regexp">/a\password = 111111&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\username = nova&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[keystone_authtoken\]<span class="regexp">/a\project_name = service&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\user_domain_name = Default&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[keystone_authtoken\]<span class="regexp">/a\project_domain_name = Default&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\auth_type = password&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[keystone_authtoken\]<span class="regexp">/a\memcached_servers = controller:11211&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\auth_url = http://controller:5000/v3&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[vnc\]<span class="regexp">/a\novncproxy_base_url =  http:/</span><span class="regexp">/controller:6080/</span>vnc_auto.html<span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[vnc\]/</span>a\server_proxyclient_address = <span class="variable">$my_ip</span><span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[vnc\]/</span>a\server_listen = <span class="number">0.0</span>.<span class="number">0.0</span><span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[vnc\]/</span>a\enabled = true<span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[glance\]/</span>a\api_servers = http:<span class="regexp">//</span>controller:<span class="number">9292</span><span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[oslo_concurrency\]/</span>a\lock_path = <span class="regexp">/var/</span>lib<span class="regexp">/nova/</span>tmp<span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[placement\]/</span>a\password = <span class="number">111111</span><span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[placement\]/</span>a\username = placement<span class="string">&#x27; /etc/nova/nova.confsed -i &#x27;</span><span class="regexp">/\[placement\]/</span>a\auth_url = http:<span class="regexp">//</span>controller:<span class="number">5000</span><span class="regexp">/v3&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[placement\]/a\user_domain_name = Default&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[placement\]<span class="regexp">/a\auth_type = password&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[placement\]/a\project_name = service&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[placement\]<span class="regexp">/a\project_domain_name = Default&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[placement\]/a\region_name = RegionOne&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.conf# 确定您的计算节点是否支持虚拟机的硬件加速，执行# egrep -c &#x27;(vmx|svm)&#x27; /</span>proc<span class="regexp">/cpuinfo ,返回值大于0，则支持;否则需要使用qemused -i &#x27;/</span>\[libvirt\]<span class="regexp">/a\virt_type = qemu&#x27; /</span>etc<span class="regexp">/nova/</span>nova.conf<span class="comment"># 在安装完成后注意修改：novncproxy_base_url为IP地址，IP地址为供应商地址，当除了管理网以外有多个IP地址时，选择合适的作为外部访问地址。sed -i &#x27;s/novncproxy_base_url =  http:\/\/controller:6080\/vnc_auto.html\/novncproxy_base_url =  http:\/\/192.168.0.11:6080\/vnc_auto.html/g&#x27; /etc/nova/nova.conf</span></span><br></pre></td></tr></table></figure>

<h3 id="（3）启动计算服务并配置为开机自启"><a href="#（3）启动计算服务并配置为开机自启" class="headerlink" title="（3）启动计算服务并配置为开机自启"></a>（3）启动计算服务并配置为开机自启</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 启动nova服务和后期管理虚机的libvirt服务并设为开机自启systemctl start libvirtd openstack-nova-compute &amp;&amp; systemctl enable libvirtd openstack-nova-computesystemctl status libvirtd.service openstack-nova-compute.service# 出现异常检查：<span class="regexp">/var/</span>log<span class="regexp">/nova/</span>nova-compute.log。</span><br></pre></td></tr></table></figure>

<h3 id="（4）计算节点同步及验证【controller节点】"><a href="#（4）计算节点同步及验证【controller节点】" class="headerlink" title="（4）计算节点同步及验证【controller节点】"></a>（4）计算节点同步及验证【controller节点】</h3><p><strong>控制节点查看nova-compute服务</strong></p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack <span class="built_in">compute</span> service list --service nova-<span class="built_in">compute</span>+----+--------------+-----------+------+---------+-------+----------------------------+| <span class="type">ID</span> | <span class="type">Binary</span>       | <span class="type">Host</span>      | <span class="type">Zone</span> | <span class="type">Status</span>  | <span class="type">State</span> | <span class="type">Updated</span> At                 |<span class="type">+----+--------------+-----------+------+---------+-------+----------------------------+|  7</span> | <span class="type">nova</span>-<span class="built_in">compute</span> | <span class="type">compute01</span> | <span class="type">nova</span> | <span class="type">enabled</span> | <span class="type">up</span>    | <span class="type">2021</span><span class="number">-06</span><span class="number">-01</span>T01:<span class="number">37</span>:<span class="number">54.000000</span> |<span class="type">+----+--------------+-----------+------+---------+-------+----------------------------+</span></span><br></pre></td></tr></table></figure>

<p><strong>发现计算节点主机</strong></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# su -s <span class="regexp">/bin/</span>sh -c <span class="string">&quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span> novaFound <span class="number">2</span> cell mappings.Skipping cell0 since it does not contain hosts.Getting computes <span class="keyword">from</span> cell <span class="string">&#x27;cell1&#x27;</span>: <span class="number">55</span>f5aa33-bb10-<span class="number">4965</span>-<span class="number">8200</span>-a1277413b824Found <span class="number">0</span> unmapped computes in cell: <span class="number">55</span>f5aa33-bb10-<span class="number">4965</span>-<span class="number">8200</span>-a1277413b824以后添加新的计算节点时，必须在控制器节点上运行”su -s <span class="regexp">/bin/</span>sh -c <span class="string">&quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span> nova“以注册这些新的计算节点。</span><br></pre></td></tr></table></figure>

<p><strong>设置适当的发现时间间隔（可选）</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">前面在<span class="regexp">/etc/</span>nova/nova.conf中配置的<span class="string">&#x27;discover_hosts_in_cells_interval = 300&#x27;</span>,即新节点自动注册的任务[scheduler]discover_hosts_in_cells_interval = <span class="number">300</span></span><br></pre></td></tr></table></figure>

<p><strong>验证整个计算服务nova</strong></p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack compute service list</span></span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|<span class="string"> ID </span>|<span class="string"> Binary         </span>|<span class="string"> Host       </span>|<span class="string"> Zone     </span>|<span class="string"> Status  </span>|<span class="string"> State </span>|<span class="string"> Updated At                 </span>|</span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|<span class="string">  3 </span>|<span class="string"> nova-conductor </span>|<span class="string"> controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2021-06-01T01:45:50.000000 </span>|</span><br><span class="line">|<span class="string">  5 </span>|<span class="string"> nova-scheduler </span>|<span class="string"> controller </span>|<span class="string"> internal </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2021-06-01T01:45:52.000000 </span>|</span><br><span class="line">|<span class="string">  7 </span>|<span class="string"> nova-compute   </span>|<span class="string"> compute01  </span>|<span class="string"> nova     </span>|<span class="string"> enabled </span>|<span class="string"> up    </span>|<span class="string"> 2021-06-01T01:45:54.000000 </span>|</span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack catalog list</span></span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">|<span class="string"> Name      </span>|<span class="string"> Type      </span>|<span class="string"> Endpoints                               </span>|</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">|<span class="string"> keystone  </span>|<span class="string"> identity  </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:5000/v3/     </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:5000/v3/  </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:5000/v3/    </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> glance    </span>|<span class="string"> image     </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:9292        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:9292      </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:9292         </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> nova      </span>|<span class="string"> compute   </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:8774/v2.1 </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:8774/v2.1    </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:8774/v2.1   </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">|<span class="string"> placement </span>|<span class="string"> placement </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   internal: http://controller:8778      </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   admin: http://controller:8778         </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string"> RegionOne                               </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">   public: http://controller:8778        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string">           </span>|<span class="string">                                         </span>|</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack image list</span></span><br><span class="line">+--------------------------------------+--------------+--------+</span><br><span class="line">|<span class="string"> ID                                   </span>|<span class="string"> Name         </span>|<span class="string"> Status </span>|</span><br><span class="line">+--------------------------------------+--------------+--------+</span><br><span class="line">|<span class="string"> 0d2909eb-8e7f-4fdf-8a1f-8dba06b12c1c </span>|<span class="string"> cirros-0.3.5 </span>|<span class="string"> active </span>|</span><br><span class="line">|<span class="string"> dd460075-c351-4213-95ed-72de7ccba047 </span>|<span class="string"> cirros-0.4.0 </span>|<span class="string"> active </span>|</span><br><span class="line">|<span class="string"> 107cf0e4-b74a-4309-9b58-96d4c0cfd2ae </span>|<span class="string"> cirros-0.5.0 </span>|<span class="string"> active </span>|</span><br><span class="line">+--------------------------------------+--------------+--------+</span><br><span class="line">[root<span class="meta">@controller</span> nova]<span class="comment"># nova-status upgrade check</span></span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Upgrade Check Results                     </span>|</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Check: Cells v2                           </span>|</span><br><span class="line">|<span class="string"> Result: Success                           </span>|</span><br><span class="line">|<span class="string"> Details: None                             </span>|</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Check: Placement API                      </span>|</span><br><span class="line">|<span class="string"> Result: Success                           </span>|</span><br><span class="line">|<span class="string"> Details: None                             </span>|</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Check: Ironic Flavor Migration            </span>|</span><br><span class="line">|<span class="string"> Result: Success                           </span>|</span><br><span class="line">|<span class="string"> Details: None                             </span>|</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Check: Cinder API                         </span>|</span><br><span class="line">|<span class="string"> Result: Success                           </span>|</span><br><span class="line">|<span class="string"> Details: None                             </span>|</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Check: Policy Scope-based Defaults        </span>|</span><br><span class="line">|<span class="string"> Result: Success                           </span>|</span><br><span class="line">|<span class="string"> Details: None                             </span>|</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Check: Policy File JSON to YAML Migration </span>|</span><br><span class="line">|<span class="string"> Result: Success                           </span>|</span><br><span class="line">|<span class="string"> Details: None                             </span>|</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|<span class="string"> Check: Older than N-1 computes            </span>|</span><br><span class="line">|<span class="string"> Result: Success                           </span>|</span><br><span class="line">|<span class="string"> Details: None                             </span>|</span><br><span class="line">+-------------------------------------------+</span><br></pre></td></tr></table></figure>

<h1 id="八、控制节点-Neutron网络服务组件"><a href="#八、控制节点-Neutron网络服务组件" class="headerlink" title="八、控制节点-Neutron网络服务组件"></a>八、控制节点-Neutron网络服务组件</h1><h2 id="1、创建neutron数据库并授权"><a href="#1、创建neutron数据库并授权" class="headerlink" title="1、创建neutron数据库并授权"></a>1、创建neutron数据库并授权</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库并授权，密码设置为<span class="number">111111</span>mysql -uroot -prootCREATE <span class="keyword">DATABASE</span> neutron;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;<span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> neutron.* <span class="keyword">TO</span> <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;111111&#x27;</span>;flush <span class="keyword">privileges</span>;<span class="keyword">show</span> databases;<span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.<span class="keyword">user</span>;<span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="2、创建neutron服务凭据"><a href="#2、创建neutron服务凭据" class="headerlink" title="2、创建neutron服务凭据"></a>2、创建neutron服务凭据</h2><h3 id="（1）创建neutron用户并设置密码为111111"><a href="#（1）创建neutron用户并设置密码为111111" class="headerlink" title="（1）创建neutron用户并设置密码为111111"></a>（1）创建neutron用户并设置密码为111111</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack <span class="keyword">user</span> <span class="title">create</span> --domain default --<span class="attr">password=</span><span class="number">111111</span> neutronopenstack <span class="keyword">user</span> <span class="title">list</span></span><br></pre></td></tr></table></figure>

<h3 id="（2）将neutron授予admin角色，并添加到service项目"><a href="#（2）将neutron授予admin角色，并添加到service项目" class="headerlink" title="（2）将neutron授予admin角色，并添加到service项目"></a>（2）将neutron授予admin角色，并添加到service项目</h3><p><code>openstack role add --project service --user neutron admin</code></p>
<h3 id="（3）创建neutron服务实体"><a href="#（3）创建neutron服务实体" class="headerlink" title="（3）创建neutron服务实体"></a>（3）创建neutron服务实体</h3><p><code>openstack service create --name neutron --description &quot;OpenStack Networking&quot; network</code><br><code>openstack service list</code></p>
<h3 id="（4）创建neutron网络服务的API端点（endpoint）"><a href="#（4）创建neutron网络服务的API端点（endpoint）" class="headerlink" title="（4）创建neutron网络服务的API端点（endpoint）"></a>（4）创建neutron网络服务的API端点（endpoint）</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne network public http:<span class="regexp">//</span>controller:<span class="number">9696</span>openstack endpoint create --region RegionOne network internal http:<span class="regexp">//</span>controller:<span class="number">9696</span>openstack endpoint create --region RegionOne network admin http:<span class="regexp">//</span>controller:<span class="number">9696</span>openstack endpoint list</span><br></pre></td></tr></table></figure>

<h2 id="3、neutron相关软件安装与配置"><a href="#3、neutron相关软件安装与配置" class="headerlink" title="3、neutron相关软件安装与配置"></a>3、neutron相关软件安装与配置</h2><p><strong>做好网络名称的规划</strong></p>
<table>
<thead>
<tr>
<th>网络类型</th>
<th>网络名</th>
</tr>
</thead>
<tbody><tr>
<td>供应商网络名称provider networks name：</td>
<td></td>
</tr>
<tr>
<td>供应商网络子网1名称provider networks subnet1 name：</td>
<td></td>
</tr>
<tr>
<td>供应商网络子网2名称provider networks subnet2 name：</td>
<td></td>
</tr>
<tr>
<td>自服务私有网络名称self-service networks name：</td>
<td></td>
</tr>
<tr>
<td>自服务私有网络子网1名称self-service networks subnet1 name：</td>
<td></td>
</tr>
<tr>
<td>自服务私有网络子网2名称self-service networks subnet2 name：</td>
<td></td>
</tr>
<tr>
<td>路由名称router name：</td>
<td></td>
</tr>
</tbody></table>
<h3 id="（1）安装neutron相关软件"><a href="#（1）安装neutron相关软件" class="headerlink" title="（1）安装neutron相关软件"></a>（1）安装neutron相关软件</h3><p>dnf install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y</p>
<h3 id="（2）配置网络"><a href="#（2）配置网络" class="headerlink" title="（2）配置网络"></a>（2）配置网络</h3><p>公有网络和私有网络配置任意选择一种即可,下面的操作是两种网络都进行配置选择。</p>
<h4 id="1-公有网络：Provider-networks"><a href="#1-公有网络：Provider-networks" class="headerlink" title="1.公有网络：Provider networks"></a>1.公有网络：Provider networks</h4><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 配置neutron server的配置文件neutron.confcp -a /etc/neutron/neutron.conf&#123;,.bak&#125;grep -Ev &#x27;^$|#&#x27; /etc/neutron/neutron.conf.bak &gt; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>database<span class="symbol">\]</span>/a<span class="symbol">\c</span>onnection = mysql+pymysql://neutron:111111@controller/neutron&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\n</span>otify_nova_on_port_data_changes = true&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\n</span>otify_nova_on_port_status_changes = true&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\a</span>uth_strategy = keystone&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\t</span>ransport_url = rabbit://openstack:111111@controller&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\s</span>ervice_plugins = &#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\c</span>ore_plugin = ml2&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\p</span>assword = 111111&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\u</span>sername = neutron&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\p</span>roject_name = service&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\u</span>ser_domain_name = default&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\p</span>roject_domain_name = default&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\a</span>uth_type = password&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\m</span>emcached_servers = controller:11211&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\a</span>uth_url = http://controller:5000&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>keystone_authtoken<span class="symbol">\]</span>/a<span class="symbol">\w</span>ww_authenticate_uri = http://controller:5000&#x27; /etc/neutron/neutron.confsed -i &#x27;/<span class="symbol">\[</span>oslo_concurrency<span class="symbol">\]</span>/a<span class="symbol">\l</span>ock_path = /var/lib/neutron/tmp&#x27; /etc/neutron/neutron.confcat &gt;&gt;/etc/neutron/neutron.conf&lt;&lt;EOF[nova]auth_url = http://controller:5000auth_type = passwordproject_domain_name = defaultuser_domain_name = defaultregion_name = RegionOneproject_name = serviceusername = novapassword = 111111EOF# 配置模块化层2（ML2）插件# ML2插件使用Linux桥接器机制为实例构建第2层（桥接和交换）虚拟网络基础结构cp -a /etc/neutron/plugins/ml2/ml2_conf.ini&#123;,.bak&#125;cat &gt; /etc/neutron/plugins/ml2/ml2_conf.ini&lt;&lt;EOF[ml2]type_drivers = flat,vlantenant_network_types =mechanism_drivers = linuxbridgeextension_drivers = port_security[ml2_type_flat]flat_networks = provider[ml2_type_vlan]network_vlan_ranges = provider[securitygroup]enable_ipset = trueEOF# 配置网桥代理# Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础结构并处理安全组cp -a /etc/neutron/plugins/ml2/linuxbridge_agent.ini&#123;,.bak&#125;cat &gt; /etc/neutron/plugins/ml2/linuxbridge_agent.ini &lt;&lt; EOF[linux_bridge]physical_interface_mappings = provider:ens37[vxlan]enable_vxlan = false[securitygroup]enable_security_group = truefirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriverEOF# 要启用网络桥接器支持，通常需要加载加载br_netfilter内核模块echo net.bridge.bridge-nf-call-iptables = 1 &gt;&gt; /etc/sysctl.confecho net.bridge.bridge-nf-call-ip6tables = 1 &gt;&gt; /etc/sysctl.confmodprobe br_netfiltersysctl -p# 配置DHCP代理cp -a /etc/neutron/dhcp_agent.ini&#123;,.bak&#125;grep -Ev &#x27;^$|#&#x27; /etc/neutron/dhcp_agent.ini.bak &gt; /etc/neutron/dhcp_agent.inised -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\e</span>nable_isolated_metadata = true&#x27; /etc/neutron/dhcp_agent.inised -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\d</span>hcp_driver = neutron.agent.linux.dhcp.Dnsmasq&#x27; /etc/neutron/dhcp_agent.inised -i &#x27;/<span class="symbol">\[</span>DEFAULT<span class="symbol">\]</span>/a<span class="symbol">\i</span>nterface_driver = linuxbridge&#x27; /etc/neutron/dhcp_agent.ini# 至此公有网络的配置完成</span><br></pre></td></tr></table></figure>

<h4 id="2-私有网络：self-service-networks"><a href="#2-私有网络：self-service-networks" class="headerlink" title="2.私有网络：self-service networks"></a>2.私有网络：self-service networks</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）配置neutron server的配置文件neutron.conf</span><br><span class="line">vim <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">在之前创建provider网络时已经配置过，但self网络也有特定的配置(对应修改如下配置)</span><br><span class="line">[<span class="keyword">DEFAULT</span>]</span><br><span class="line">service_plugins = router</span><br><span class="line">allow_overlapping_ips = <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）配置模块化层<span class="number">2</span>（ML2）插件</span><br><span class="line">vim <span class="regexp">/etc/</span>neutron<span class="regexp">/plugins/m</span>l2/ml2_conf.ini</span><br><span class="line">在之前创建provider网络时已经配置过，但self网络也有特定的配置(对应修改如下配置)</span><br><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan,vxlan</span><br><span class="line">tenant_network_types = vxlan</span><br><span class="line">mechanism_drivers = linuxbridge,l2population</span><br><span class="line">extension_drivers = port_security</span><br><span class="line"></span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line"></span><br><span class="line">[ml2_type_vlan]</span><br><span class="line">network_vlan_ranges = provider</span><br><span class="line"></span><br><span class="line">[ml2_type_vxlan]</span><br><span class="line">vni_ranges = <span class="number">1</span>:<span class="number">1000</span></span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">（<span class="number">3</span>）配置Linux网桥代理</span><br><span class="line">vim <span class="regexp">/etc/</span>neutron<span class="regexp">/plugins/m</span>l2/linuxbridge_agent.ini</span><br><span class="line">Linux网桥代理为实例构建第<span class="number">2</span>层（桥接和交换）虚拟网络基础结构并处理安全组。</span><br><span class="line">在之前创建provider网络时已经配置过，但self网络也有特定的配置(对应修改如下配置)</span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens37</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="keyword">true</span></span><br><span class="line">local_ip = <span class="number">10.0</span>.<span class="number">0.11</span></span><br><span class="line">l2_population = <span class="keyword">true</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="keyword">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"></span><br><span class="line"># 配置加载br_netfilter内核模块，公有网络配置时已做过</span><br><span class="line"></span><br><span class="line">（<span class="number">4</span>）配置第<span class="number">3</span>层L3代理</span><br><span class="line">cp <span class="regexp">/etc/</span>neutron/l3_agent.ini&#123;,.bak&#125;</span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\interface_driver = linuxbridge&#x27;</span> <span class="regexp">/etc/</span>neutron/l3_agent.ini</span><br><span class="line"></span><br><span class="line">（<span class="number">5</span>）配置DHCP代理</span><br><span class="line">DHCP代理为虚拟网络提供DHCP服务。</span><br><span class="line"><span class="regexp">/etc/</span>neutron/dhcp_agent.ini</span><br><span class="line">在之前创建provider网络时已经配置过，此处self网络的配置与其相同。</span><br></pre></td></tr></table></figure>

<h2 id="4、配置元数据代理"><a href="#4、配置元数据代理" class="headerlink" title="4、配置元数据代理"></a>4、配置元数据代理</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/</span>neutron<span class="regexp">/metadata_agent.ini&#123;,.bak&#125;grep -Ev &#x27;^$|#&#x27; /</span>etc<span class="regexp">/neutron/m</span>etadata_agent.ini.bak &gt; <span class="regexp">/etc/</span>neutron<span class="regexp">/metadata_agent.ini# 此处将：METADATA_SECRET的值设置为neutrosed -i &#x27;/</span>\[<span class="keyword">DEFAULT</span>\]<span class="regexp">/a\metadata_proxy_shared_secret = neutron&#x27; /</span>etc<span class="regexp">/neutron/m</span>etadata_agent.inised -i <span class="string">&#x27;/\[DEFAULT\]/a\nova_metadata_host = controller&#x27;</span> <span class="regexp">/etc/</span>neutron<span class="regexp">/metadata_agent.inised -i &#x27;/</span>\[keystone_authtoken\]<span class="regexp">/a\memcached_servers = controller:11211&#x27; /</span>etc<span class="regexp">/neutron/m</span>etadata_agent.ini</span><br></pre></td></tr></table></figure>

<h2 id="5、为Nova配置网络服务"><a href="#5、为Nova配置网络服务" class="headerlink" title="5、为Nova配置网络服务"></a>5、为Nova配置网络服务</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\metadata_proxy_shared_secret = neutron&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[neutron\]<span class="regexp">/a\service_metadata_proxy = true&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[neutron\]/a\password = 111111&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[neutron\]<span class="regexp">/a\username = neutron&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[neutron\]/a\project_name = service&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[neutron\]<span class="regexp">/a\region_name = RegionOne&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[neutron\]/a\user_domain_name = default&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[neutron\]<span class="regexp">/a\project_domain_name = default&#x27; /</span>etc<span class="regexp">/nova/</span>nova.confsed -i <span class="string">&#x27;/\[neutron\]/a\auth_type = password&#x27;</span> <span class="regexp">/etc/</span>nova<span class="regexp">/nova.confsed -i &#x27;/</span>\[neutron\]<span class="regexp">/a\auth_url = http:/</span><span class="regexp">/controller:5000&#x27; /</span>etc<span class="regexp">/nova/</span>nova.conf</span><br></pre></td></tr></table></figure>

<h2 id="6、初始数据库并启动服务"><a href="#6、初始数据库并启动服务" class="headerlink" title="6、初始数据库并启动服务"></a>6、初始数据库并启动服务</h2><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.初始化安装网络插件</span><br><span class="line">创建网络插件的软连接，初始化网络的脚本插件会用到/etc/neutron/plugin.ini，需要使用ML2的插件进行提供</span><br><span class="line">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.填充数据库</span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</span></span><br><span class="line"><span class="string">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span> neutron</span><br><span class="line">最后输出OK。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.重新启动Compute API服务</span><br><span class="line">systemctl restart openstack-nova-api.<span class="keyword">service</span></span><br><span class="line">systemctl status openstack-nova-api.<span class="keyword">service</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>.启动neutron网络服务并设置开机启动</span><br><span class="line">systemctl start neutron-server.<span class="keyword">service</span> neutron-linuxbridge-agent.<span class="keyword">service</span> neutron-dhcp-agent.<span class="keyword">service</span>   neutron-metadata-agent.<span class="keyword">service</span></span><br><span class="line">systemctl enable neutron-server.<span class="keyword">service</span> neutron-linuxbridge-agent.<span class="keyword">service</span> neutron-dhcp-agent.<span class="keyword">service</span>   neutron-metadata-agent.<span class="keyword">service</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="keyword">list</span>-unit-files |grep neutron* |grep enabled</span><br><span class="line">systemctl status neutron-server.<span class="keyword">service</span> neutron-linuxbridge-agent.<span class="keyword">service</span> neutron-dhcp-agent.<span class="keyword">service</span>   neutron-metadata-agent.<span class="keyword">service</span></span><br><span class="line"></span><br><span class="line">如果在二配置网络选项时，使用选项<span class="number">2</span>，还应再启动第<span class="number">3</span>层服务</span><br><span class="line">systemctl start neutron-l3-agent.<span class="keyword">service</span></span><br><span class="line">systemctl enable neutron-l3-agent.<span class="keyword">service</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>.查看网络代理</span><br><span class="line">openstack network <span class="keyword">list</span></span><br><span class="line">openstack network agent <span class="keyword">list</span></span><br></pre></td></tr></table></figure>

<h2 id="7、创建网络选项"><a href="#7、创建网络选项" class="headerlink" title="7、创建网络选项"></a>7、创建网络选项</h2><h3 id="（1）公有网络：Provider-networks"><a href="#（1）公有网络：Provider-networks" class="headerlink" title="（1）公有网络：Provider networks"></a>（1）公有网络：Provider networks</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 创建网络provider</span><br><span class="line">openstack network create --share --external --provider-physical-network provider --provider-network-type flat providernet</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line">--share 指明所有项目都可以使用这个网络，否则只有创建者能使用 </span><br><span class="line"></span><br><span class="line">--external 指明是外部网络 </span><br><span class="line"></span><br><span class="line">--provider-physical-network provider  指明物理网络的提供者，与下面neutron的配置文件对应，其中provider是标签，可以更改为其他，但是2个地方必须要统一。</span><br><span class="line"><span class="section">vim /etc/neutron/plugins/ml2/ml2_conf.ini</span></span><br><span class="line"><span class="section">-----------------------------</span></span><br><span class="line"><span class="meta">[ml2_type_flat]</span></span><br><span class="line"><span class="section">flat_networks = provider</span></span><br><span class="line"><span class="section">-----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="section">vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span><br><span class="line"><span class="section">-----------------------------</span></span><br><span class="line"><span class="meta">[linux_bridge]</span></span><br><span class="line"><span class="section">physical_interface_mappings = provider:ens37</span></span><br><span class="line"><span class="section">-----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="code"> --provider-network-type flat  指明这里创建的网络是flat类型，即实例连接到此网络时和物理网络是在同一个网段，无vlan等功能。</span></span><br><span class="line">vm-network 网络名称</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建子网：subnet</span><br><span class="line">openstack subnet create --network providernet --allocation-pool start=192.168.1.160,end=192.168.1.180 --dns-nameserver 1.1.1.1 --gateway 192.168.1.1 --subnet-range 192.168.1.0/24 providernet-subnet1</span><br><span class="line"></span><br><span class="line"># 同一个父网络下也支持创建多个子网络。</span><br><span class="line">#openstack subnet create --network provider --no-dhcp --allocation-pool start=192.168.1.210,end=192.168.1.220 --dns-nameserver 4.4.4.4 --gateway 192.168.1.1 --subnet-range 192.168.1.0/24 provider-subnet2</span><br><span class="line"></span><br><span class="line">#openstack subnet create --network provider --dhcp --subnet-range 192.168.1.0/24 provider-subnet3</span><br></pre></td></tr></table></figure>

<h3 id="（2）私有网络：Self-service-networks"><a href="#（2）私有网络：Self-service-networks" class="headerlink" title="（2）私有网络：Self-service networks"></a>（2）私有网络：Self-service networks</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">检查确认网络配置</span><br><span class="line"><span class="section">#  cat /etc/neutron/plugins/ml2/ml2_conf.ini</span></span><br><span class="line"><span class="section">---------------------------------------------------------</span></span><br><span class="line"><span class="meta">[ml2]</span></span><br><span class="line">type<span class="emphasis">_drivers = flat,vlan,vxlan</span></span><br><span class="line"><span class="emphasis">tenant_network_types = vxlan</span></span><br><span class="line"><span class="emphasis">mechanism_drivers = linuxbridge,l2population</span></span><br><span class="line"><span class="emphasis">extension_drivers = port_</span>security</span><br><span class="line"></span><br><span class="line"><span class="meta">[ml2_type_flat]</span></span><br><span class="line">flat_networks = provider</span><br><span class="line"></span><br><span class="line"><span class="meta">[ml2_type_vlan]</span></span><br><span class="line">network_vlan_ranges = provider</span><br><span class="line"></span><br><span class="line"><span class="meta">[ml2_type_vxlan]</span></span><br><span class="line">vni_ranges = 1:1000</span><br><span class="line"></span><br><span class="line"><span class="meta">[securitygroup]</span></span><br><span class="line"><span class="section">enable_ipset = True</span></span><br><span class="line"><span class="section">---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"># 创建网络</span><br><span class="line">openstack network create selfservicenet</span><br><span class="line"></span><br><span class="line"># 创建子网</span><br><span class="line">openstack subnet create --network selfservicenet --dns-nameserver 8.8.8.8 --gateway 172.16.1.1   --subnet-range 172.16.1.0/24 selfservicenet-subnet1</span><br><span class="line"></span><br><span class="line"># 创建路由,每个路由器均包含至少一个自助服务网络上的接口和提供商网络上的网关</span><br><span class="line">openstack router create router1</span><br><span class="line">openstack router add subnet router1 selfservicenet-subnet1</span><br><span class="line">openstack router set router1 --external-gateway providernet</span><br><span class="line">openstack port list --router router1</span><br><span class="line">ip netns</span><br></pre></td></tr></table></figure>

<h1 id="九、计算节点-Neutron网络服务组件"><a href="#九、计算节点-Neutron网络服务组件" class="headerlink" title="九、计算节点-Neutron网络服务组件"></a>九、计算节点-Neutron网络服务组件</h1><h2 id="1、安装相关软件"><a href="#1、安装相关软件" class="headerlink" title="1、安装相关软件"></a>1、安装相关软件</h2><p>dnf install -y openstack-neutron-linuxbridge ebtables ipset openstack-neutron openstack-neutron-ml2</p>
<h2 id="2、配置公共组件"><a href="#2、配置公共组件" class="headerlink" title="2、配置公共组件"></a>2、配置公共组件</h2><p>网络公共组件配置包括身份验证机制，消息队列和插件。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cp -a <span class="regexp">/etc/</span>neutron/neutron.conf&#123;,.bak&#125;</span><br><span class="line"><span class="keyword">grep</span> -Ev <span class="string">&#x27;^$|#&#x27;</span> <span class="regexp">/etc/</span>neutron<span class="regexp">/neutron.conf.bak &gt; /</span>etc<span class="regexp">/neutron/</span>neutron.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\transport_url = rabbit://openstack:111111@controller&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[DEFAULT\]/a\auth_strategy = keystone&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\password = 111111&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\username = neutron&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\project_name = service&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\user_domain_name = default&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\project_domain_name = default&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\auth_type = password&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\memcached_servers = controller:11211&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\auth_url = http://controller:5000&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[keystone_authtoken\]/a\www_authenticate_uri = http://controller:5000&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/\[oslo_concurrency\]/a\lock_path = /var/lib/neutron/tmp&#x27;</span> <span class="regexp">/etc/</span>neutron/neutron.conf</span><br></pre></td></tr></table></figure>

<h2 id="3、配置网络选项"><a href="#3、配置网络选项" class="headerlink" title="3、配置网络选项"></a>3、配置网络选项</h2><p>公有网络和私有网络配置任意选择一种即可，但要与控制节点保持一致，这里仍然是两种网络都配置。</p>
<h3 id="（1）公有网络：Provider-networks-1"><a href="#（1）公有网络：Provider-networks-1" class="headerlink" title="（1）公有网络：Provider networks"></a>（1）公有网络：Provider networks</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）配置Linux网桥代理</span><br><span class="line">Linux网桥代理为实例构建第<span class="number">2</span>层（桥接和交换）虚拟网络基础结构并处理安全组。</span><br><span class="line"></span><br><span class="line">cp -a <span class="regexp">/etc/</span>neutron<span class="regexp">/plugins/m</span>l2/linuxbridge_agent.ini&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line">cat &gt; <span class="regexp">/etc/</span>neutron<span class="regexp">/plugins/m</span>l2/linuxbridge_agent.ini &lt;&lt;EOF</span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings provider:ens37</span><br><span class="line"></span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="keyword">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line">EOF</span><br><span class="line">注：第一个选项physical_interface_mappings选项要配置计算节点自身的网卡名称provider:ens37</span><br><span class="line"></span><br><span class="line"># 加载br_netfilter内核模块。要启用网络桥接器支持，通常br_netfilter内核模块需要加载.</span><br><span class="line">echo net.bridge.bridge-nf-<span class="keyword">call</span>-iptables = <span class="number">1</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line">echo net.bridge.bridge-nf-<span class="keyword">call</span>-ip6tables = <span class="number">1</span> &gt;&gt; <span class="regexp">/etc/</span>sysctl.conf</span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="（2）私有网络：Self-service-networks-1"><a href="#（2）私有网络：Self-service-networks-1" class="headerlink" title="（2）私有网络：Self-service networks"></a>（2）私有网络：Self-service networks</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础结构并处理安全组。</span></span><br><span class="line">配置为私有网络，需要修改/etc/neutron/plugins/ml2/linuxbridge_agent.ini配置</span><br><span class="line">[linux_bridge]</span><br><span class="line"><span class="attr">physical_interface_mappings</span> = provider:ens37</span><br><span class="line">[vxlan]</span><br><span class="line"><span class="attr">enable_vxlan</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">10.0</span>.<span class="number">0.31</span></span><br><span class="line"><span class="attr">l2_population</span> = <span class="literal">true</span></span><br><span class="line">[securitygroup]</span><br><span class="line"><span class="attr">enable_security_group</span> = <span class="literal">true</span></span><br><span class="line">firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前面已经执行过br_netfilter内核模块加载（略）</span></span><br></pre></td></tr></table></figure>

<h2 id="4、计算节点-为Nova配置网络服务"><a href="#4、计算节点-为Nova配置网络服务" class="headerlink" title="4、计算节点:为Nova配置网络服务"></a>4、计算节点:为Nova配置网络服务</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\password = 111111&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\username = neutron&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\project_name = service&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\region_name = RegionOne&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\user_domain_name = default&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\project_domain_name = default&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\auth_type = password&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\url = http://controller:9696&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line">sed -i <span class="string">&#x27;/\[neutron\]/a\auth_url = http://controller:5000&#x27;</span> <span class="regexp">/etc/</span>nova/nova.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Nova服务</span></span><br><span class="line">systemctl restart openstack-nova-compute.service</span><br><span class="line">systemctl status openstack-nova-compute.service</span><br></pre></td></tr></table></figure>

<h2 id="5、启动Linux网桥代理，并配置开机自启"><a href="#5、启动Linux网桥代理，并配置开机自启" class="headerlink" title="5、启动Linux网桥代理，并配置开机自启"></a>5、启动Linux网桥代理，并配置开机自启</h2><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">systemctl</span> <span class="string">restart</span> <span class="string">neutron-linuxbridge-agent</span>.<span class="string">service</span></span><br><span class="line"><span class="string">systemctl</span> <span class="string">enable</span> <span class="string">neutron-linuxbridge-agent</span>.<span class="string">service</span></span><br><span class="line"><span class="string">systemctl</span> <span class="built_in">list-unit-files</span> |<span class="string">grep</span> <span class="string">neutron</span>* |<span class="string">grep</span> <span class="string">enabled</span></span><br><span class="line"><span class="string">systemctl</span> <span class="string">status</span> <span class="string">neutron-linuxbridge-agent</span>.<span class="string">service</span></span><br></pre></td></tr></table></figure>

<h2 id="6、验证neutron服务【controller节点】"><a href="#6、验证neutron服务【controller节点】" class="headerlink" title="6、验证neutron服务【controller节点】"></a>6、验证neutron服务【controller节点】</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看加载的网络插件,列出已加载的扩展，以验证该neutron-server过程是否成功启动</span></span><br><span class="line">openstack extension list --network</span><br><span class="line">neutron ext-list</span><br><span class="line">ip netns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网络代理列表</span></span><br><span class="line">[root<span class="meta">@controller</span> ~]<span class="comment"># openstack network agent list</span></span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">|<span class="string"> ID                                   </span>|<span class="string"> Agent Type         </span>|<span class="string"> Host       </span>|<span class="string"> Availability Zone </span>|<span class="string"> Alive </span>|<span class="string"> State </span>|<span class="string"> Binary                    </span>|</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">|<span class="string"> 1fb6df9f-ef39-4ebc-9f3e-c45a997129a6 </span>|<span class="string"> Linux bridge agent </span>|<span class="string"> controller </span>|<span class="string"> None              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-linuxbridge-agent </span>|</span><br><span class="line">|<span class="string"> 732528ad-3d1d-4b7d-8772-bca9477906e4 </span>|<span class="string"> Metadata agent     </span>|<span class="string"> controller </span>|<span class="string"> None              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-metadata-agent    </span>|</span><br><span class="line">|<span class="string"> a5216309-5051-4104-af70-d000e29612c6 </span>|<span class="string"> Linux bridge agent </span>|<span class="string"> compute01  </span>|<span class="string"> None              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-linuxbridge-agent </span>|</span><br><span class="line">|<span class="string"> c54e85e6-3b5b-4463-a925-7a7471c92b69 </span>|<span class="string"> DHCP agent         </span>|<span class="string"> controller </span>|<span class="string"> nova              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-dhcp-agent        </span>|</span><br><span class="line">|<span class="string"> f1b8eef6-d688-4046-84ab-f67d3573a4a8 </span>|<span class="string"> L3 agent           </span>|<span class="string"> controller </span>|<span class="string"> nova              </span>|<span class="string"> :-)   </span>|<span class="string"> UP    </span>|<span class="string"> neutron-l3-agent          </span>|</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br></pre></td></tr></table></figure>

<h1 id="十、安装与配置dashboard相关软件"><a href="#十、安装与配置dashboard相关软件" class="headerlink" title="十、安装与配置dashboard相关软件"></a>十、安装与配置dashboard相关软件</h1><h2 id="1、安装软件包"><a href="#1、安装软件包" class="headerlink" title="1、安装软件包"></a>1、安装软件包</h2><p><code>dnf install openstack-dashboard -y</code></p>
<h2 id="2、配置文件修改"><a href="#2、配置文件修改" class="headerlink" title="2、配置文件修改"></a>2、配置文件修改</h2><h3 id="（1）local-settings"><a href="#（1）local-settings" class="headerlink" title="（1）local_settings"></a>（1）local_settings</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">cp -a /etc/openstack-dashboard/local_settings&#123;,.bak&#125;</span><br><span class="line">grep -Ev <span class="string">&#x27;^$|#&#x27;</span> /etc/openstack-dashboard/local_settings.bak &gt; /etc/openstack-dashboard/local_settings</span><br><span class="line"></span><br><span class="line"># 配置仪表盘在controller节点上使用openstack服务</span><br><span class="line">OPENSTACK_HOST = <span class="string">&quot;controller&quot;</span></span><br><span class="line"></span><br><span class="line"># 配置运行访问仪表盘的主机，星号表示运行所有主机访问</span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]</span><br><span class="line"></span><br><span class="line"># 配置memcached会话存储服务</span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">         <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;controller:11211&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 启用身份API版本<span class="number">3</span></span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">&quot;http://%s:5000/v3&quot;</span> % OPENSTACK_HOST</span><br><span class="line">TIME_ZONE = <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line"></span><br><span class="line"># 上面几项修改即可，以下为新增信息</span><br><span class="line"></span><br><span class="line"># 启用对域的支持</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"># 配置API版本</span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    <span class="string">&quot;identity&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">&quot;image&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;volume&quot;</span>: <span class="number">3</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 配置默认域</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">&quot;Default&quot;</span></span><br><span class="line"></span><br><span class="line"># 配置默认角色</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">&quot;user&quot;</span></span><br><span class="line"></span><br><span class="line"># 启用对第<span class="number">3</span>层网络服务的支持，若是公有网络则需要禁用，将<span class="literal">True</span>改为<span class="literal">False</span></span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;enable_router&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;enable_quotas&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;enable_distributed_router&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;enable_ha_router&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;enable_lb&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;enable_firewall&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;enable_vpn&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;enable_fip_topology_check&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="（2）openstack-dashboard-conf"><a href="#（2）openstack-dashboard-conf" class="headerlink" title="（2）openstack-dashboard.conf"></a>（2）openstack-dashboard.conf</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span>openstack-dashboard.conf&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line">echo &gt;&gt; <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span>openstack-dashboard.conf &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Apache服务、会话存储服务</span></span><br><span class="line">systemctl restart httpd.service memcached.service</span><br></pre></td></tr></table></figure>

<h3 id="（3）重建apache的dashboard配置文件"><a href="#（3）重建apache的dashboard配置文件" class="headerlink" title="（3）重建apache的dashboard配置文件"></a>（3）重建apache的dashboard配置文件</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>share/openstack-dashboard</span><br><span class="line">python3 manage.py make_web_conf --apache &gt; <span class="regexp">/etc/</span>httpd<span class="regexp">/conf.d/</span>openstack-dashboard.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立策略文件（policy.json）的软链接</span></span><br><span class="line">ln -s <span class="regexp">/etc/</span>openstack-dashboard <span class="regexp">/usr/</span>share<span class="regexp">/openstack-dashboard/</span>openstack_dashboard/conf</span><br></pre></td></tr></table></figure>

<h3 id="（4）重启Web服务器和会话存储服务"><a href="#（4）重启Web服务器和会话存储服务" class="headerlink" title="（4）重启Web服务器和会话存储服务"></a>（4）重启Web服务器和会话存储服务</h3><figure class="highlight thrift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd.<span class="keyword">service</span> memcached.<span class="keyword">service</span></span><br><span class="line">systemctl restart httpd.<span class="keyword">service</span> memcached.<span class="keyword">service</span></span><br></pre></td></tr></table></figure>

<h3 id="（5）访问Dashboard"><a href="#（5）访问Dashboard" class="headerlink" title="（5）访问Dashboard"></a>（5）访问Dashboard</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">访问：http:<span class="string">//10.0.0.11</span></span><br><span class="line">在Dashboard中可以分别创建不同网络选项的实例来验证安装。</span><br><span class="line"></span><br><span class="line">附：快速创建实例类型</span><br><span class="line">openstack flavor create <span class="params">--id</span> 0 <span class="params">--vcpus</span> 1 <span class="params">--ram</span> 256 <span class="params">--disk</span> 0 1U256M0G</span><br><span class="line">openstack flavor create <span class="params">--id</span> 2 <span class="params">--vcpus</span> 1 <span class="params">--ram</span> 1024 <span class="params">--disk</span> 0 1U1G0G</span><br><span class="line">openstack flavor create <span class="params">--id</span> 3 <span class="params">--vcpus</span> 1 <span class="params">--ram</span> 2048 <span class="params">--disk</span> 0 1U2G0G</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Openstack/" rel="tag"><i class="fa fa-tag"></i> Openstack</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/05/25/CentOS7%20firewalld%20%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/" rel="prev" title="CentOS7 firewalld 的相关配置">
      <i class="fa fa-chevron-left"></i> CentOS7 firewalld 的相关配置
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E5%89%8D%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">一、安装前准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81VMware-Workstation%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.1.</span> <span class="nav-text">1、VMware Workstation虚拟网络设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%A1%AC%E4%BB%B6%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">2、虚拟机硬件设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E4%B8%BB%E6%9C%BA%E8%A7%84%E5%88%92"><span class="nav-number">1.3.</span> <span class="nav-text">3、主机规划</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">二、基础环境的安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.</span> <span class="nav-text">环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E4%B8%BB%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.1.</span> <span class="nav-text">1、主机基础网络配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E6%9B%B4%E6%8D%A2%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">（1）更换网络服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E9%9D%99%E6%80%81IP%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">（2）静态IP配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E7%BD%91%E5%8D%A1ens33"><span class="nav-number">2.1.1.2.1.</span> <span class="nav-text">管理网络网卡ens33</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BE%9B%E5%BA%94%E5%95%86%E7%BD%91%E7%BB%9C%E7%BD%91%E5%8D%A1ens37"><span class="nav-number">2.1.1.2.2.</span> <span class="nav-text">供应商网络网卡ens37</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%9B%B4%E6%8D%A2%E4%B8%BA%E5%9B%BD%E5%86%85yum%E6%BA%90"><span class="nav-number">2.1.2.</span> <span class="nav-text">2、更换为国内yum源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81hostname%E4%B8%BB%E6%9C%BA%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.3.</span> <span class="nav-text">3、hostname主机名配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.4.</span> <span class="nav-text">4、时间同步配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81SSH%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.5.</span> <span class="nav-text">5、SSH免密登录配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E7%A6%81%E7%94%A8%E9%98%B2%E7%81%AB%E5%A2%99%EF%BC%8C%E5%85%B3%E9%97%ADselinux"><span class="nav-number">2.1.6.</span> <span class="nav-text">6、禁用防火墙，关闭selinux</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="nav-number">2.2.</span> <span class="nav-text">软件安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">2.2.1.</span> <span class="nav-text">1、常用工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81OpenStack%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7"><span class="nav-number">2.2.2.</span> <span class="nav-text">2、OpenStack客户端工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="nav-number">2.2.3.</span> <span class="nav-text">3、数据库【controller节点】</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97Rabbitmq%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="nav-number">2.2.4.</span> <span class="nav-text">4、消息队列Rabbitmq【controller节点】</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81Memcached%E7%BC%93%E5%AD%98%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="nav-number">2.2.5.</span> <span class="nav-text">5、Memcached缓存【controller节点】</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81Etcd%E9%9B%86%E7%BE%A4%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="nav-number">2.2.6.</span> <span class="nav-text">6、Etcd集群【controller节点】</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-%E5%AE%89%E8%A3%85keystone%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.</span> <span class="nav-text">三、控制节点-安装keystone身份认证服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAkeystone%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="nav-number">3.1.</span> <span class="nav-text">1、创建keystone数据库并授权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81keystone%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">3.2.</span> <span class="nav-text">2、keystone相关软件安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85keystone%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="nav-number">3.2.1.</span> <span class="nav-text">（1）安装keystone相关软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E4%BF%AE%E6%94%B9-etc-keystone-keystone-conf%E6%96%87%E4%BB%B6"><span class="nav-number">3.2.2.</span> <span class="nav-text">（2）修改&#x2F;etc&#x2F;keystone&#x2F;keystone.conf文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%8C%E6%AD%A5keystone%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.2.3.</span> <span class="nav-text">（3）初始化同步keystone数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E5%88%9D%E5%A7%8B%E5%8C%96Fernet%E4%BB%A4%E7%89%8C%E5%BA%93"><span class="nav-number">3.2.4.</span> <span class="nav-text">（4）初始化Fernet令牌库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E5%88%9D%E5%A7%8B%E5%8C%96%E5%BC%95%E5%AF%BCkeystone%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.2.5.</span> <span class="nav-text">（5）初始化引导keystone认证服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%886%EF%BC%89%E9%85%8D%E7%BD%AE%E5%90%AF%E5%8A%A8Apache-Http%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.2.6.</span> <span class="nav-text">（6）配置启动Apache Http服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%887%EF%BC%89%E5%88%9B%E5%BB%BA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%84%9A%E6%9C%AC"><span class="nav-number">3.2.7.</span> <span class="nav-text">（7）创建环境变量脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%888%EF%BC%89%E5%88%9B%E5%BB%BAkeystone%E7%9A%84%E4%B8%80%E8%88%AC%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.2.8.</span> <span class="nav-text">（8）创建keystone的一般实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%889%EF%BC%89%E9%AA%8C%E8%AF%81%E6%93%8D%E4%BD%9Ckeystone%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F"><span class="nav-number">3.2.9.</span> <span class="nav-text">（9）验证操作keystone是否安装配置成功</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-%E5%AE%89%E8%A3%85glance%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.</span> <span class="nav-text">四、控制节点-安装glance镜像服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAglance%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="nav-number">4.1.</span> <span class="nav-text">1、创建glance数据库并授权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%87%AD%E6%8D%AE"><span class="nav-number">4.2.</span> <span class="nav-text">2.创建服务凭据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%9C%A8keystone%E4%B8%8A%E5%88%9B%E5%BB%BAglance%E7%94%A8%E6%88%B7"><span class="nav-number">4.2.1.</span> <span class="nav-text">（1）在keystone上创建glance用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%9C%A8keystone%E4%B8%8A%E5%B0%86glance%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E4%B8%BAservice%E9%A1%B9%E7%9B%AE%E7%9A%84admin%E8%A7%92%E8%89%B2-%E6%9D%83%E9%99%90"><span class="nav-number">4.2.2.</span> <span class="nav-text">（2）在keystone上将glance用户添加为service项目的admin角色(权限)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%88%9B%E5%BB%BAglance%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%9E%E4%BD%93"><span class="nav-number">4.2.3.</span> <span class="nav-text">（3）创建glance镜像服务的实体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E7%9A%84-API-%E7%AB%AF%E7%82%B9%EF%BC%88endpoint%EF%BC%89"><span class="nav-number">4.2.4.</span> <span class="nav-text">（4）创建镜像服务的 API 端点（endpoint）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81glance%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">4.3.</span> <span class="nav-text">3、glance相关软件安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85glance%E8%BD%AF%E4%BB%B6"><span class="nav-number">4.3.1.</span> <span class="nav-text">（1）安装glance软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9"><span class="nav-number">4.3.2.</span> <span class="nav-text">（2）配置文件修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%90%8C%E6%AD%A5glance%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">4.3.3.</span> <span class="nav-text">（3）同步glance数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89glance%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="nav-number">4.3.4.</span> <span class="nav-text">（4）glance镜像服务启动并设置开机自启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E9%AA%8C%E8%AF%81"><span class="nav-number">4.3.5.</span> <span class="nav-text">（5）镜像上传验证</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-Placement%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">五、控制节点-Placement服务组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAplacement%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="nav-number">5.1.</span> <span class="nav-text">1、创建placement数据库并授权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%87%AD%E6%8D%AE"><span class="nav-number">5.2.</span> <span class="nav-text">2、创建服务凭据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81placement%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">5.3.</span> <span class="nav-text">3、placement相关软件安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85placement%E8%BD%AF%E4%BB%B6"><span class="nav-number">5.3.1.</span> <span class="nav-text">（1）安装placement软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9-1"><span class="nav-number">5.3.2.</span> <span class="nav-text">（2）配置文件修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%90%8C%E6%AD%A5placement%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">5.3.3.</span> <span class="nav-text">（3）同步placement数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E9%87%8D%E5%90%AFApache%E6%9C%8D%E5%8A%A1%EF%BC%88httpd%EF%BC%89"><span class="nav-number">5.3.4.</span> <span class="nav-text">（4）重启Apache服务（httpd）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E6%A3%80%E6%9F%A5Placement%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81"><span class="nav-number">5.3.5.</span> <span class="nav-text">（5）检查Placement服务状态</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-Nova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">六、控制节点-Nova计算服务组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="nav-number">6.1.</span> <span class="nav-text">1、创建数据库并授权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E5%87%AD%E6%8D%AE"><span class="nav-number">6.2.</span> <span class="nav-text">2、创建计算服务凭据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%9C%A8keystone%E4%B8%8A%E5%88%9B%E5%BB%BAnova%E7%94%A8%E6%88%B7"><span class="nav-number">6.2.1.</span> <span class="nav-text">（1）在keystone上创建nova用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%9C%A8keystone%E4%B8%8A%E5%B0%86nova%E7%94%A8%E6%88%B7%EF%BC%8C%E9%85%8D%E7%BD%AE%E4%B8%BAadmin%E8%A7%92%E8%89%B2%EF%BC%8C%E5%B9%B6%E6%B7%BB%E5%8A%A0%E8%BF%9Bservice%E9%A1%B9%E7%9B%AE"><span class="nav-number">6.2.2.</span> <span class="nav-text">（2）在keystone上将nova用户，配置为admin角色，并添加进service项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%88%9B%E5%BB%BAnova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%9E%E4%BD%93"><span class="nav-number">6.2.3.</span> <span class="nav-text">（3）创建nova计算服务的实体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E5%88%9B%E5%BB%BAcompute-API%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%82%B9"><span class="nav-number">6.2.4.</span> <span class="nav-text">（4）创建compute API服务端点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81nova%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">6.3.</span> <span class="nav-text">3、nova相关软件安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85nova%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6"><span class="nav-number">6.3.1.</span> <span class="nav-text">（1）安装nova相关软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9-2"><span class="nav-number">6.3.2.</span> <span class="nav-text">（2）配置文件修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%90%8C%E6%AD%A5%E5%B9%B6%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E6%B3%A8%E6%84%8F%E9%A1%BA%E5%BA%8F%EF%BC%89"><span class="nav-number">6.3.3.</span> <span class="nav-text">（3）同步并创建相关数据库（注意顺序）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E5%90%AF%E5%8A%A8%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="nav-number">6.3.4.</span> <span class="nav-text">（4）启动计算服并设置开机自启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E9%AA%8C%E8%AF%81%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%E5%90%AF%E5%8A%A8"><span class="nav-number">6.3.5.</span> <span class="nav-text">（5）验证服务是否成功启动</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9-Nova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="nav-number">7.</span> <span class="nav-text">七、计算节点-Nova计算服务组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81nova%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">7.1.</span> <span class="nav-text">1、nova相关软件安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85nova%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6-1"><span class="nav-number">7.1.1.</span> <span class="nav-text">（1）安装nova相关软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9-3"><span class="nav-number">7.1.2.</span> <span class="nav-text">（2）配置文件修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%90%AF%E5%8A%A8%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E5%B9%B6%E9%85%8D%E7%BD%AE%E4%B8%BA%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="nav-number">7.1.3.</span> <span class="nav-text">（3）启动计算服务并配置为开机自启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E5%90%8C%E6%AD%A5%E5%8F%8A%E9%AA%8C%E8%AF%81%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="nav-number">7.1.4.</span> <span class="nav-text">（4）计算节点同步及验证【controller节点】</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-Neutron%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="nav-number">8.</span> <span class="nav-text">八、控制节点-Neutron网络服务组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BAneutron%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="nav-number">8.1.</span> <span class="nav-text">1、创建neutron数据库并授权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BAneutron%E6%9C%8D%E5%8A%A1%E5%87%AD%E6%8D%AE"><span class="nav-number">8.2.</span> <span class="nav-text">2、创建neutron服务凭据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%88%9B%E5%BB%BAneutron%E7%94%A8%E6%88%B7%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81%E4%B8%BA111111"><span class="nav-number">8.2.1.</span> <span class="nav-text">（1）创建neutron用户并设置密码为111111</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%B0%86neutron%E6%8E%88%E4%BA%88admin%E8%A7%92%E8%89%B2%EF%BC%8C%E5%B9%B6%E6%B7%BB%E5%8A%A0%E5%88%B0service%E9%A1%B9%E7%9B%AE"><span class="nav-number">8.2.2.</span> <span class="nav-text">（2）将neutron授予admin角色，并添加到service项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%88%9B%E5%BB%BAneutron%E6%9C%8D%E5%8A%A1%E5%AE%9E%E4%BD%93"><span class="nav-number">8.2.3.</span> <span class="nav-text">（3）创建neutron服务实体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E5%88%9B%E5%BB%BAneutron%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E7%9A%84API%E7%AB%AF%E7%82%B9%EF%BC%88endpoint%EF%BC%89"><span class="nav-number">8.2.4.</span> <span class="nav-text">（4）创建neutron网络服务的API端点（endpoint）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81neutron%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">8.3.</span> <span class="nav-text">3、neutron相关软件安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85neutron%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6"><span class="nav-number">8.3.1.</span> <span class="nav-text">（1）安装neutron相关软件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C"><span class="nav-number">8.3.2.</span> <span class="nav-text">（2）配置网络</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%85%AC%E6%9C%89%E7%BD%91%E7%BB%9C%EF%BC%9AProvider-networks"><span class="nav-number">8.3.2.1.</span> <span class="nav-text">1.公有网络：Provider networks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9C%EF%BC%9Aself-service-networks"><span class="nav-number">8.3.2.2.</span> <span class="nav-text">2.私有网络：self-service networks</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E9%85%8D%E7%BD%AE%E5%85%83%E6%95%B0%E6%8D%AE%E4%BB%A3%E7%90%86"><span class="nav-number">8.4.</span> <span class="nav-text">4、配置元数据代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81%E4%B8%BANova%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="nav-number">8.5.</span> <span class="nav-text">5、为Nova配置网络服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6%E3%80%81%E5%88%9D%E5%A7%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">8.6.</span> <span class="nav-text">6、初始数据库并启动服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7%E3%80%81%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E9%80%89%E9%A1%B9"><span class="nav-number">8.7.</span> <span class="nav-text">7、创建网络选项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%85%AC%E6%9C%89%E7%BD%91%E7%BB%9C%EF%BC%9AProvider-networks"><span class="nav-number">8.7.1.</span> <span class="nav-text">（1）公有网络：Provider networks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9C%EF%BC%9ASelf-service-networks"><span class="nav-number">8.7.2.</span> <span class="nav-text">（2）私有网络：Self-service networks</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9-Neutron%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="nav-number">9.</span> <span class="nav-text">九、计算节点-Neutron网络服务组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6"><span class="nav-number">9.1.</span> <span class="nav-text">1、安装相关软件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6"><span class="nav-number">9.2.</span> <span class="nav-text">2、配置公共组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E9%80%89%E9%A1%B9"><span class="nav-number">9.3.</span> <span class="nav-text">3、配置网络选项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%85%AC%E6%9C%89%E7%BD%91%E7%BB%9C%EF%BC%9AProvider-networks-1"><span class="nav-number">9.3.1.</span> <span class="nav-text">（1）公有网络：Provider networks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9C%EF%BC%9ASelf-service-networks-1"><span class="nav-number">9.3.2.</span> <span class="nav-text">（2）私有网络：Self-service networks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9-%E4%B8%BANova%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="nav-number">9.4.</span> <span class="nav-text">4、计算节点:为Nova配置网络服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81%E5%90%AF%E5%8A%A8Linux%E7%BD%91%E6%A1%A5%E4%BB%A3%E7%90%86%EF%BC%8C%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="nav-number">9.5.</span> <span class="nav-text">5、启动Linux网桥代理，并配置开机自启</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6%E3%80%81%E9%AA%8C%E8%AF%81neutron%E6%9C%8D%E5%8A%A1%E3%80%90controller%E8%8A%82%E7%82%B9%E3%80%91"><span class="nav-number">9.6.</span> <span class="nav-text">6、验证neutron服务【controller节点】</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEdashboard%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6"><span class="nav-number">10.</span> <span class="nav-text">十、安装与配置dashboard相关软件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="nav-number">10.1.</span> <span class="nav-text">1、安装软件包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9"><span class="nav-number">10.2.</span> <span class="nav-text">2、配置文件修改</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%881%EF%BC%89local-settings"><span class="nav-number">10.2.1.</span> <span class="nav-text">（1）local_settings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89openstack-dashboard-conf"><span class="nav-number">10.2.2.</span> <span class="nav-text">（2）openstack-dashboard.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E9%87%8D%E5%BB%BAapache%E7%9A%84dashboard%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">10.2.3.</span> <span class="nav-text">（3）重建apache的dashboard配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E9%87%8D%E5%90%AFWeb%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E4%BC%9A%E8%AF%9D%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">10.2.4.</span> <span class="nav-text">（4）重启Web服务器和会话存储服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E8%AE%BF%E9%97%AEDashboard"><span class="nav-number">10.2.5.</span> <span class="nav-text">（5）访问Dashboard</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lei"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Lei</p>
  <div class="site-description" itemprop="description">备忘~</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lei</span>
</div>
  <div class="powered-by">o(=•ェ•=)m 备忘
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
